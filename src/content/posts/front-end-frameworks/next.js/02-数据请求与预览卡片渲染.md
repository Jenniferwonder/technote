---
topic: 
type: 
category: Front-End Frameworks
Datereviewed: 
reviewed: 
difficulty: 
comment: 
title: 02-æ•°æ®è¯·æ±‚ä¸é¢„è§ˆå¡ç‰‡æ¸²æŸ“
tags:
  - NextJS
status:
  - ""
DateStarted: 2022-11-08
sr-due: 2023-07-02
sr-interval: 4
sr-ease: 281
DateModified: 2024-04-19
draft: true
---

## æŠ€æœ¯æ ˆ

å‰ç«¯ï¼š[100-Front-End Roadmap/1. TechSkills/1.2 Web Dev/1.2.3 Front-End Frameworks/React/React](100-Front-End-Roadmap/1.-TechSkills/1.2-Web-Dev/1.2.3-Front-End-Frameworks/React/React), [O-NextJS](O-NextJS), [C-TailwindCSS](C-TailwindCSS) , [TypeScript](TypeScript)  
åç«¯ -CMSï¼š[Sanity](Sanity)

## é¡¹ç›®å¯åŠ¨æ­¥éª¤

#### 1. è¿è¡Œå¼€å‘ç¯å¢ƒ

- è¿è¡Œ `npm run dev`

#### 2. æ‰“å¼€åå°å†…å®¹ç®¡ç†ç³»ç»Ÿï¼šSanity Studio

- è¿›å…¥> é¡¹ç›®æ–‡ä»¶å¤¹ (å‰ç«¯ï¼Œå« package.json) >**Sanity é¡¹ç›®æ–‡ä»¶å¤¹** (åç«¯ï¼Œå« package.json)
- è¾“å…¥ `sanity login`> `sanity start`
- å¯èƒ½ Bug ![](https://cdn.jsdelivr.net/gh/jenniferwonder/bimg/full-stack/Pasted-image-20230219224930.png)
  - åœ¨æ’ä»¶æ ¹ç›®å½•æ·»åŠ  sanity.json æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹è§æç¤ºç½‘ç«™
- æˆåŠŸæç¤ºï¼š![](https://cdn.nlark.com/yuque/0/2022/png/29677165/1667816734814-c82315ac-430a-469d-9ba1-e0fba8f5ba1e.png)

#### 3. æ‰“å¼€åå°ç½‘å€å¹¶ç™»å½•ï¼šhttp://localhost:3333

- æˆåŠŸæç¤ºï¼š![](https://cdn.nlark.com/yuque/0/2022/png/29677165/1667816908364-20aa7c2b-cf30-445b-bead-7fdca9ac140a.png)
- å¯ä»¥çœ‹åˆ°æä¾›çš„ **æ¨¡æ¿è¡¨å•æ¡ç›® (schemas)ï¼Œå¯ä¸ªæ€§åŒ–è®¾è®¡è°ƒæ•´**

## åå°æ•°æ®åº“ä¸å‰ç«¯è¿æ¥é…ç½®

#### 1. è¿›å…¥ Sanity é¡¹ç›®æ–‡ä»¶å¤¹> /schemas> post.jsï¼Œä¸ªæ€§åŒ–è°ƒæ•´è¡¨å•æ¡ç›®ä¸ç±»å‹

- åœ¨åå°ç½‘ç«™, åˆ›å»ºä¸€æ¡ Post
- ![|230](https://cdn.nlark.com/yuque/0/2022/png/29677165/1667887075605-f31e8541-a923-457a-a315-e64444f0578a.png)
- é€‰æ‹© Vision æ ‡ç­¾> è¾“å…¥ Query æŒ‡ä»¤ï¼Œå¯ä»¥è·å– Post æ•°æ®

```bash
*[_type =="post"]{
_id,
title,
author->{
name,
image
},
description,
mainImage,
slug
}
```

- GROQ: [https://www.sanity.io/docs/query-cheat-sheet](https://www.sanity.io/docs/query-cheat-sheet)

#### 2. å®‰è£…æ’ä»¶ next-sanity: ä¾¿äº API è¯·æ±‚ï¼Œå°†åå°å†…å®¹ä¸å‰ç«¯è¿æ¥

- è¿›å…¥> é¡¹ç›®æ–‡ä»¶å¤¹ **æ ¹ç›®å½•**
- æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ `npm i next-sanity`

#### 3. åœ¨æ ¹ç›®å½•ï¼Œåˆ›å»ºé…ç½®æ–‡ä»¶

- sanity.js
  - å°†åå°æ•°æ®åº“ä¸å‰ç«¯è¿æ¥
- .env.local
  - å­˜æ”¾ç¯å¢ƒå˜é‡

#### 4. è®¾ç½® env.local

- æ‰“å¼€/static > sanity.jsonï¼Œ è·å–ç›¸å…³å‚æ•°
- PUBLIC å‚æ•°ï¼šå®¢æˆ·ç«¯ä¸ API åŒæ—¶å¯è§

```bash
NEXT_PUBLIC_SANITY_DATASET=production
NEXT_PUBLIC_SANITY_PROJECT_ID=j70xi0l8
```

#### 5. è®¾ç½® sanity.js é…ç½®æ–‡ä»¶ï¼ˆä¸ firebase.js åŸç†ç±»ä¼¼ï¼‰

- å‚è€ƒæ•™ç¨‹ï¼š[https://www.sanity.io/guides/sanity-nextjs-tailwindcss](https://www.sanity.io/guides/sanity-nextjs-tailwindcss)

```JavaScript
import {
  createImageUrlBuilder,
  createCurrentUserHook,
  createClient,
} from "next-sanity"; // æ³¨æ„è¯¥æ–¹æ¡ˆå°†æŠ¥é”™ï¼šImageUrlBuilderä¸å†å—æ”¯æŒï¼
export const config = {
  /*COMMENT:
	 * Find your project ID and dataset in `sanity.json` in your studio project.
	 * These are considered â€œpublicâ€, but you can use environment variables
	 * if you want differ between local dev and production.
	 *
	 * https://nextjs.org/docs/basic-features/environment-variables
	 **/
  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET || "production",
  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID,
  apiVersion: "2021-08-11", // or today's date for latest
  /**
	 * Set useCdn to `false` if your application require the freshest possible
	 * data always (potentially slightly slower and a bit more expensive).
	 * Authenticated request (like preview) will always bypass the CDN
	 **/
  useCdn: process.env.NODE_ENV === "production",
};
// COMMENT: Set up the client for fetching data in the getProps page function
export const sanityClient = createClient(config);
// COMMENT: Set up a helper function for generating Image URLs with only the asset reference data in your documents
export const urlFor = (source) => createImageUrlBuilder(config).image(source);
// COMMENT: Helper function for using the current logged in user account
export const useCurrentUser = createCurrentUserHook(config);
```

- âŒ! æ³¨æ„ next-sanity ä¸å†æ”¯æŒ createImageUrlBuilderï¼Œå°†å‡ºç°å›¾ç‰‡é“¾æ¥æ’ä»¶æŠ¥é”™ï¼Œå‚è€ƒï¼š[https://stackoverflow.com/questions/71277628/typeerror-0-next-sanity-webpack-imported-module-0-createimageurlbuilder](https://stackoverflow.com/questions/71277628/typeerror-0-next-sanity-webpack-imported-module-0-createimageurlbuilder)
- ![|300](https://cdn.nlark.com/yuque/0/2022/png/29677165/1667892113084-da88f4f1-eeaa-4b98-b970-cf50a90f72c2.png)
- éœ€è¦å¦å¤–åœ¨æ ¹ç›®å½•ä¸‹è½½ image-urlï¼š `npm install @sanity/image-url`

```JS
import { createCurrentUserHook, createClient } from "next-sanity";
import createImageUrlBuilder from "./node_modules/@sanity/image-url";
```

## åšæ–‡é¢„è§ˆå¡ç‰‡

### æ•°æ®è¯·æ±‚ï¼šSSR- æœåŠ¡ç«¯æ¸²æŸ“

- æ¯æ¬¡è¯·æ±‚ï¼Œæ¸²æŸ“ä¸€æ¬¡ï¼šNext.js ä½œä¸ºä¸­é—´æœåŠ¡å™¨ï¼Œå°†è¯·æ±‚é¡µé¢æ¸²æŸ“ç»™å®¢æˆ·ç«¯ï¼›
- é¿å…è¯·æ±‚æ—¶ï¼Œå®¢æˆ·ç«¯ä¸€æ¬¡åŠ è½½å…¨éƒ¨å†…å®¹ (bundle)
- å°†é¡µé¢è·¯å¾„ï¼ˆPage routeï¼‰è½¬åŒ–ä¸ºæœåŠ¡ç«¯è·¯å¾„ (Server-side route)

#### 1. å®ç°ï¼šå¦‚ä½•åœ¨ Next.js ä¸­å®ç° SSRï¼Ÿ

- æ‰“å¼€ index.tsxï¼Œæ·»åŠ å‡½æ•° getServerSidePropsï¼Œå°†æœåŠ¡ç«¯æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œ
- ğŸ’¡ éš¾ç‚¹ï¼šå°† **props** è¿”å›ç»™ Home å‡½æ•°

```TSX
import { sanityClient, urlFor } from "../sanity";
/* Get the Server Side Rendered Data back to the Client*/
export const getServerSideProps = async () => {
  const query = `*[_type =="post"]{
		_id,
		title,
		author->{
		name,
		image
	},
	description,
	mainImage,
	slug
	}`;
  const posts = await sanityClient.fetch(query);
  return {
    props: {
      posts,
    },
  };
};
```

- ğŸ’¡ éš¾ç‚¹ï¼šå®šä¹‰ **props ç±»å‹**
- æ ¹ç›®å½•åˆ›å»º TypeScript å®šä¹‰æ–‡ä»¶ï¼š**typings.d.ts**
- å¯åœ¨åå°ç½‘ç«™ Post > Inspectï¼ŒæŸ¥çœ‹æ•°æ®ç±»å‹

```ts
export interface Post {
	_id: string;
	_createdAt: string;
	title: string;
	author: {
		name: string;
		image: string;
	};
	description: string;
	mainImage: {
		asset: {
			url: string;
		};
	};
	slug: {
		current: string;
	};
	body: [object];
}
```

- å®šä¹‰ props ç±»å‹

```tsx
import { Post } from "../typings";
interface Props {
	posts: [Post];
}
export default function Home({ posts }: Props) {}
```

### é¢„è§ˆå¡ç‰‡ï¼šæ ·å¼

- å‚è€ƒï¼š[Tailwind CSS å®˜æ–¹æ–‡æ¡£](https://tailwindcss.com/docs/guides/create-react-app)

```tsx
{
	/* Posts */
}
<div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3:gap-6 p-2 lg:p-6">
	{posts.map((post) => (
		<Link key={post._id} href={`/post/${post.slug.current}`}>
			<div className="group cursor-pointer border rounded-lg overflow-hidden">
				<img
					className="h-60 w-full object-cover group-hover:scale-105 transition-transform duration-200 ease-in-out"
					src={urlFor(post.mainImage).url()!}
					alt=""
				/>
				<div className="flex justify-between p-5 bg-white">
					<div>
						<p className="text-lg font-bold">{post.title}</p>
						<p className="text-xs">
							{post.description} by {post.author.name}
						</p>
					</div>
					<img
						className="h-12 w-12 rounded-full"
						src={urlFor(post.author.image).url()!}
						alt=""
					/>
				</div>
			</div>
		</Link>
	))}
</div>;
```
