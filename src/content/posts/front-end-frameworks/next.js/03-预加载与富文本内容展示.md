---
topic: 
category: Front-End Frameworks
Datereviewed: 
reviewed: 
difficulty: 
comment: 
type: Note
DateModified: 2024-09-14
title: 03-é¢„åŠ è½½ä¸å¯Œæ–‡æœ¬å†…å®¹å±•ç¤º
tags:
  - NextJS
status:
  - ""
DateStarted: 2022-11-09
sr-due: 2023-07-02
sr-interval: 4
sr-ease: 273
draft: true
---

### å‰è¨€

æœ¬æ–‡å°†åˆ†äº« React, Next.js å®ç°é¢„åŠ è½½ï¼Œä»¥åŠå¯Œæ–‡æœ¬å†…å®¹å±•ç¤ºçš„æ–¹æ³•ã€‚

### æŠ€æœ¯æ ˆ

å‰ç«¯ï¼šReact, Next.js, Tailwind CSS , TypeScript  
åç«¯ -CMSï¼šSanity

### Next.jsï¼šè·å–é¢„åŠ è½½å†…å®¹

- åŸç†ï¼šincremental static regenerationï¼ˆå®šæ—¶æ¸²æŸ“ï¼‰
- æ‰“å¼€ /pagesï¼Œæ–°å»º /post> **[slug].tsx**ï¼Œè¯¥æ–‡ä»¶ç”¨äºå±•ç¤ºåšæ–‡å†…å®¹
- åŠ å…¥ç»„ä»¶/å‡½æ•°
- [slug].tsx(Import)

```tsx TI:"[slug].tsx"
import { GetStaticProps } from "next";
import { sanityClient, urlFor } from "sanity";
```

#### 1. ğŸ’¡ éš¾ç‚¹ï¼šåœ¨ [slug].tsx å®šä¹‰ä¸‹åˆ—å‡½æ•°

- getStaticPaths: æ¥è‡ª Sanity
- getStaticProps: æ¥è‡ª Next.js

```tsx
export const getStaticPaths = async () => {
	const query = `*[_type =="post"]{ _id, slug { current } }`;
	const posts = await sanityClient.fetch(query);
	const paths = posts.map((post: Post) => ({
		params: {
			slug: post.slug.current,
		},
	}));
	return {
		paths,
		fallback: "blocking",
	};
};
```

```tsx
export const getStaticProps: GetStaticProps = async ({ params }) => {
	const query = `*[_type =="post" && slug.current == $slug][0]{ _id, _createdAt, title, author->{ name, image }, 'comments': *[ _type== "comment" && post._ref ==^._id && approved == true], description, mainImage, slug, body }`;
	const post = await sanityClient.fetch(query, {
		slug: params?.slug,
	});
	if (!post) {
		return {
			notFound: true,
		};
	}
	return {
		props: { post },
		revalidate: 60, // after 60 seconds, it'll update old cached version
	};
};
```

### é˜…è¯»é¡µå¤´éƒ¨ï¼šæ ·å¼

- å‚è€ƒï¼š[Tailwind CSS å®˜æ–¹æ–‡æ¡£](https://tailwindcss.com/docs/guides/create-react-app)

```tsx
<Header />
{/_ Banner _/}
<img
  className="w-full h-40 object-cover"
  src={urlFor(post.mainImage).url()!}
  alt=""
/>
<article className="max-w-3xl mx-auto p-5">
  <h1 className="text-3xl mt-10 mb-3">{post.title}</h1>
  <h2 className="text-xl font-light text-grey-500 mb-2">
  	{post.description}
  </h2>
  <div className="flex items-center space-x-2">
    <img
      className="h-10 w-10 rounded-full"
      src={urlFor(post.author.image).url()!}
      alt=""
    />
    <p className="font-extralight text-sm">
      Blog post by{" "}
    	<span className="text-green-600">{post.author.name}</span> -
      Published at {new Date(post._createdAt).toLocaleString()}
  	</p>
	</div>
    {/* Display Rich Content */}
</article>
```

### å¯Œæ–‡æœ¬å†…å®¹å±•ç¤º

- ä¸‹è½½ç»„ä»¶ï¼š`npm i react-portable-text`
- import PortableText from "react-portable-text";

```tsx
{
	/_ Display Rich Content _/;
}
<div className="mt-10">
	<PortableText
		className=""
		dataset={process.env.NEXT_PUBLIC_SANITY_DATASET!}
		projectId={process.env.NEXT_PUBLIC_SANITY_PROJECT_ID!}
		content={post.body}
		serializers={{
			h1: (props: any) => <h1 className="text-2xl font-bold my-5" {...props} />,
			h2: (props: any) => <h1 className="text-xl font-bold my-5" {...props} />,
			li: ({ children }: any) => <li className="ml-4 list-disc">{children}</li>,
			link: ({ href, children }: any) => (
				<a href={href} className="text-blue-500 hover:underline">
					{children}
				</a>
			),
		}}
	/>
</div>;
```
