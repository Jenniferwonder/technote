import{createComponent,renderTemplate,maybeRenderHead,unescapeHTML}from"../../../../astro.mjs";import"kleur/colors";import"clsx";import"html-escaper";import"cssesc";const html='<blockquote>\n<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch API - Web APIs | MDN</a></p>\n</blockquote>\n<h2 id="what-is-fetch-api">What is <code>fetch</code> API?<a class="anchor" href="#what-is-fetch-api"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2>\n<p>Fetch:\na built-in function that returns a <a href="Async/Promise">Promise</a> to query URL/API data <strong>async</strong>hronously.</p>\n<ul>\n<li>The <code>fetch()</code> method takes one mandatory argument, the <strong>path</strong> to the resource you want to fetch.</li>\n<li>It returns a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a> / <a href="Async/Promise">Promise</a> that resolves to the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response"><code>Response</code></a> to that request — as soon as the server responds with headers — <strong>even if the server response is an HTTP error status</strong>.</li>\n</ul>\n<h2 id="基础">基础<a class="anchor" href="#基础"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2>\n<p>一些知识点：</p>\n<ul>\n<li>响应返回 4xx 和 4xx 的状态码时，不会 reject</li>\n<li>只在网络失败时 reject</li>\n<li>默认不发送和接收 cookie</li>\n<li>相比 Ajax 通常只处理 JSON 和 XML，fetch 可以处理更多数据类型</li>\n</ul>\n<h3 id="cors">cors<a class="anchor" href="#cors"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#B392F0">fetch</span><span style="color:#E1E4E8">(url, {</span></span>\n<span class="line"><span style="color:#E1E4E8">  mode: </span><span style="color:#9ECBFF">\'no-cors\'</span><span style="color:#E1E4E8">,</span></span>\n<span class="line"><span style="color:#E1E4E8">});</span></span>\n<span class="line"></span></code></pre>\n<p>可以配在 HTML 元素的 src 上的数据都可以配 <code>no-cors</code>，比如图片、音频、视频、脚本等。</p>\n<h2 id="use">Use<a class="anchor" href="#use"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#B392F0">fetch</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"https://reqres.in/api/users"</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// return a Promise</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">res</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(res)); </span><span style="color:#6A737D">// return a Response Object</span></span>\n<span class="line"></span></code></pre>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#B392F0">fetch</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"https://reqres.in/api/users"</span><span style="color:#E1E4E8">)</span></span>\n<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">res</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> res.</span><span style="color:#B392F0">json</span><span style="color:#E1E4E8">())</span></span>\n<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">data</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#6A737D">    // ...</span></span>\n<span class="line"><span style="color:#E1E4E8">  });</span></span>\n<span class="line"></span></code></pre>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> getData</span><span style="color:#F97583"> =</span><span style="color:#F97583"> async</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">url</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">  try</span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> res</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> fetch</span><span style="color:#E1E4E8">(url);</span></span>\n<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> data</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> res.</span><span style="color:#B392F0">json</span><span style="color:#E1E4E8">();</span></span>\n<span class="line"><span style="color:#6A737D">    // ...</span></span>\n<span class="line"><span style="color:#E1E4E8">  } </span><span style="color:#F97583">catch</span><span style="color:#E1E4E8">(e) {</span></span>\n<span class="line"><span style="color:#6A737D">    // ...</span></span>\n<span class="line"><span style="color:#E1E4E8">  }</span></span>\n<span class="line"><span style="color:#E1E4E8">}</span></span>\n<span class="line"></span></code></pre>\n<h3 id="optional">Optional<a class="anchor" href="#optional"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<p>You can create a request and response directly using the [<code>Request()</code>](<a href="https://developer.mozilla.org/en-US/docs/Web/API/Request/Request">https://developer.mozilla.org/en-US/docs/Web/API/Request/Request</a> Request()) and [<code>Response()</code>](<a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/Response">https://developer.mozilla.org/en-US/docs/Web/API/Response/Response</a> Response()) constructors, but it’s uncommon to do this directly.</p>\n<h4 id="request">Request<a class="anchor" href="#request"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<blockquote>\n<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Request/Request">Request() - Web APIs | MDN</a>\nYou can also optionally pass in an <code>init</code> options object as the second argument (see <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request"><code>Request</code></a>).</p>\n</blockquote>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> headers</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Headers</span><span style="color:#E1E4E8">({</span></span>\n<span class="line"><span style="color:#9ECBFF">  \'Content-Type\'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">\'text/plain\'</span><span style="color:#E1E4E8">,</span></span>\n<span class="line"><span style="color:#E1E4E8">});</span></span>\n<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> options</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#E1E4E8">  method,</span></span>\n<span class="line"><span style="color:#E1E4E8">  headers,</span></span>\n<span class="line"><span style="color:#E1E4E8">  mode: </span><span style="color:#9ECBFF">\'cors\'</span><span style="color:#E1E4E8">,</span></span>\n<span class="line"><span style="color:#E1E4E8">  cache: </span><span style="color:#9ECBFF">\'default\'</span><span style="color:#E1E4E8">,</span></span>\n<span class="line"><span style="color:#E1E4E8">};</span></span>\n<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> request</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Request</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">\'a.jpg\'</span><span style="color:#E1E4E8">, options);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#B392F0">fetch</span><span style="color:#E1E4E8">(request)</span></span>\n<span class="line"><span style="color:#6A737D">  // .then();</span></span>\n<span class="line"></span></code></pre>\n<h5 id="1-how-to-post-data">1. How to <code>post</code> data?<a class="anchor" href="#1-how-to-post-data"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>\n<ul>\n<li>set <code>method</code>: <code>\'POST\'</code></li>\n<li>set <code>headers</code>: <code>\'Content-Type\': \'application/json\'</code></li>\n<li>set <code>body</code>: <code>JSON.stringify()</code></li>\n</ul>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#B392F0">fetch</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"https://reqres.in/api/users"</span><span style="color:#E1E4E8">, {</span></span>\n<span class="line"><span style="color:#E1E4E8">\tmethod: </span><span style="color:#79B8FF">POST</span><span style="color:#E1E4E8">,</span></span>\n<span class="line"><span style="color:#E1E4E8">\theaders: {</span></span>\n<span class="line"><span style="color:#9ECBFF">\t\t\'Accept\'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">\'application/json\'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">\'text/plain\'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">\'*/*\'</span><span style="color:#E1E4E8">,</span></span>\n<span class="line"><span style="color:#9ECBFF">\t\t\'Content-Type\'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">\'application/json\'</span><span style="color:#E1E4E8">,</span></span>\n<span class="line"><span style="color:#E1E4E8">\t},</span></span>\n<span class="line"><span style="color:#E1E4E8">\tbody: </span><span style="color:#79B8FF">JSON</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">stringify</span><span style="color:#E1E4E8">({</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\tname: User </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span></span>\n<span class="line"><span style="color:#E1E4E8">\t}),</span></span>\n<span class="line"><span style="color:#E1E4E8">});</span></span>\n<span class="line"></span></code></pre>\n<ul>\n<li>Result:\n<ul>\n<li><img src="https://cdn.jsdelivr.net/gh/jenniferwonder/bimg/programming/Pasted-image-20221210115058.png" alt=""></li>\n</ul>\n</li>\n</ul>\n<h4 id="response">Response<a class="anchor" href="#response"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<p>Once a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response"><code>Response</code></a> is retrieved, there are a number of methods available to define what the <strong>body</strong> content/ <strong>JSON</strong> is and how it should be handled.</p>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">res.</span><span style="color:#B392F0">blob</span><span style="color:#E1E4E8">();</span></span>\n<span class="line"><span style="color:#E1E4E8">res.</span><span style="color:#B392F0">json</span><span style="color:#E1E4E8">();</span></span>\n<span class="line"><span style="color:#E1E4E8">res.</span><span style="color:#B392F0">text</span><span style="color:#E1E4E8">();</span></span>\n<span class="line"><span style="color:#E1E4E8">res.</span><span style="color:#B392F0">formData</span><span style="color:#E1E4E8">();</span></span>\n<span class="line"><span style="color:#E1E4E8">res.</span><span style="color:#B392F0">arrayBuffer</span><span style="color:#E1E4E8">();</span></span>\n<span class="line"></span></code></pre>\n<h5 id="resblob怎么用"><code>res.blob()</code> 怎么用？<a class="anchor" href="#resblob怎么用"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>\n<p>比如：fetch 一个图片的数据，然后转成 url 赋到图片元素上。</p>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#B392F0">fetch</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">\'a.jpg\'</span><span style="color:#E1E4E8">)</span></span>\n<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">res</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> res.</span><span style="color:#B392F0">blob</span><span style="color:#E1E4E8">())</span></span>\n<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">res</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> url</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> URL</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">createObjectURL</span><span style="color:#E1E4E8">(res);</span></span>\n<span class="line"><span style="color:#E1E4E8">    imageEl.src </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> url;</span></span>\n<span class="line"><span style="color:#E1E4E8">  });</span></span>\n<span class="line"></span></code></pre>\n<h5 id="1-convert-the-json-response-to-object">1. Convert the JSON response to Object<a class="anchor" href="#1-convert-the-json-response-to-object"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>\n<ul>\n<li><img src="https://cdn.jsdelivr.net/gh/jenniferwonder/bimg/programming/Pasted-image-20221210111900.png" alt=""></li>\n<li><code>res.json()</code> returns a <a href="Async/Promise">Promise</a> that <strong>resolves</strong> to an <a href="../object/object">object</a> containing all the JSON data</li>\n<li><img src="https://cdn.jsdelivr.net/gh/jenniferwonder/bimg/programming/Pasted-image-20221210112955.png" alt=""></li>\n</ul>\n<h5 id="2-how-to-handle-http-error-status">2. How to handle HTTP error status?<a class="anchor" href="#2-how-to-handle-http-error-status"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">if</span><span style="color:#E1E4E8"> (res.ok) {</span></span>\n<span class="line"><span style="color:#E1E4E8">\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">SUCCESS</span><span style="color:#E1E4E8">);</span></span>\n<span class="line"><span style="color:#E1E4E8">} </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#E1E4E8">\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">NOT</span><span style="color:#79B8FF"> SUCCESSFUL</span><span style="color:#E1E4E8">);</span></span>\n<span class="line"><span style="color:#E1E4E8">}</span></span>\n<span class="line"><span style="color:#E1E4E8">res.json;</span></span>\n<span class="line"></span></code></pre>',frontmatter={title:"fetch-api",topic:["Data"],tags:["JavaScript"],type:"D",DateStarted:"2022-12-05T00:00:00.000Z",DateModified:"2024-06-11T00:00:00.000Z",Datereviewed:null,reviewed:2,status:null,comment:null,difficulty:null,category:"Programming",draft:!1,minutes:2,words:401},file="E:/SynologyDrive/Codespace/blog-site/mynote/my-fuwari-blog/src/content/posts/js/data-fetching/fetch-api.md",url=void 0;function rawContent(){return"> [Fetch API - Web APIs | MDN](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)\n## What is `fetch` API?\nFetch: \na built-in function that returns a [Promise](Async/Promise) to query URL/API data **async**hronously.\n- The `fetch()` method takes one mandatory argument, the **path** to the resource you want to fetch.\n- It returns a [`Promise`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise) / [Promise](Async/Promise) that resolves to the [`Response`](https://developer.mozilla.org/en-US/docs/Web/API/Response) to that request — as soon as the server responds with headers — **even if the server response is an HTTP error status**.\n## 基础\n一些知识点：\n- 响应返回 4xx 和 4xx 的状态码时，不会 reject\n- 只在网络失败时 reject\n- 默认不发送和接收 cookie\n- 相比 Ajax 通常只处理 JSON 和 XML，fetch 可以处理更多数据类型\n\n### cors\n```js\nfetch(url, {\n  mode: 'no-cors',\n});\n```\n可以配在 HTML 元素的 src 上的数据都可以配 `no-cors`，比如图片、音频、视频、脚本等。\n\n## Use\n```js\nfetch(\"https://reqres.in/api/users\") // return a Promise\n\t.then((res) => console.log(res)); // return a Response Object\n```\n\n```js\nfetch(\"https://reqres.in/api/users\")\n  .then(res => res.json())\n  .then(data => {\n    // ...\n  });\n```\n\n```js\nconst getData = async (url) => {\n  try {\n    const res = await fetch(url);\n    const data = await res.json();\n    // ...\n  } catch(e) {\n    // ...\n  }\n}\n```\n\n### Optional\nYou can create a request and response directly using the [`Request()`](https://developer.mozilla.org/en-US/docs/Web/API/Request/Request Request()) and [`Response()`](https://developer.mozilla.org/en-US/docs/Web/API/Response/Response Response()) constructors, but it's uncommon to do this directly.\n#### Request\n> [Request() - Web APIs | MDN](https://developer.mozilla.org/en-US/docs/Web/API/Request/Request)\nYou can also optionally pass in an `init` options object as the second argument (see [`Request`](https://developer.mozilla.org/en-US/docs/Web/API/Request)).\n\n```js\nconst headers = new Headers({\n  'Content-Type': 'text/plain',\n});\nconst options = {\n  method,\n  headers,\n  mode: 'cors',\n  cache: 'default',\n};\nconst request = new Request('a.jpg', options);\n\nfetch(request)\n  // .then();\n```\n\n##### 1. How to `post` data?\n- set `method`: `'POST'`\n- set `headers`: `'Content-Type': 'application/json'`\n- set `body`: `JSON.stringify()`\n```js\nfetch(\"https://reqres.in/api/users\", {\n\tmethod: POST,\n\theaders: {\n\t\t'Accept': 'application/json', 'text/plain', '*/*',\n\t\t'Content-Type': 'application/json',\n\t},\n\tbody: JSON.stringify({\n\t\tname: User 1,\n\t}),\n});\n```\n- Result:\n  - ![](https://cdn.jsdelivr.net/gh/jenniferwonder/bimg/programming/Pasted-image-20221210115058.png)\n#### Response\nOnce a [`Response`](https://developer.mozilla.org/en-US/docs/Web/API/Response) is retrieved, there are a number of methods available to define what the **body** content/ **JSON** is and how it should be handled.\n```js\nres.blob();\nres.json();\nres.text();\nres.formData();\nres.arrayBuffer();\n```\n\n##### `res.blob()` 怎么用？\n\n比如：fetch 一个图片的数据，然后转成 url 赋到图片元素上。\n\n```js\nfetch('a.jpg')\n  .then(res => res.blob())\n  .then(res => {\n    const url = URL.createObjectURL(res);\n    imageEl.src = url;\n  });\n```\n\n##### 1. Convert the JSON response to Object\n- ![](https://cdn.jsdelivr.net/gh/jenniferwonder/bimg/programming/Pasted-image-20221210111900.png)\n- `res.json()` returns a [Promise](Async/Promise) that **resolves** to an [object](../object/object) containing all the JSON data\n- ![](https://cdn.jsdelivr.net/gh/jenniferwonder/bimg/programming/Pasted-image-20221210112955.png)\n##### 2. How to handle HTTP error status?\n```js\nif (res.ok) {\n\tconsole.log(SUCCESS);\n} else {\n\tconsole.log(NOT SUCCESSFUL);\n}\nres.json;\n```\n"}function compiledContent(){return html}function getHeadings(){return[{depth:2,slug:"what-is-fetch-api",text:"What is fetch API?#"},{depth:2,slug:"基础",text:"基础#"},{depth:3,slug:"cors",text:"cors#"},{depth:2,slug:"use",text:"Use#"},{depth:3,slug:"optional",text:"Optional#"},{depth:4,slug:"request",text:"Request#"},{depth:5,slug:"1-how-to-post-data",text:"1. How to post data?#"},{depth:4,slug:"response",text:"Response#"},{depth:5,slug:"resblob怎么用",text:"res.blob() 怎么用？#"},{depth:5,slug:"1-convert-the-json-response-to-object",text:"1. Convert the JSON response to Object#"},{depth:5,slug:"2-how-to-handle-http-error-status",text:"2. How to handle HTTP error status?#"}]}const Content=createComponent(((s,n,e)=>{const{layout:a,...o}=frontmatter;return o.file=file,o.url=url,renderTemplate`${maybeRenderHead()}${unescapeHTML(html)}`}));export{Content,compiledContent,Content as default,file,frontmatter,getHeadings,rawContent,url};