import{createComponent,renderTemplate,maybeRenderHead,unescapeHTML}from"../../../../chunks/1726300354279/astro.mjs";import"kleur/colors";import"clsx";import"html-escaper";import"cssesc";const id="js/data-fetching/promise-chaining-é“¾å¼è°ƒç”¨.md",collection="posts",slug="js/data-fetching/promise-chaining-é“¾å¼è°ƒç”¨",body="# Promise Chaining-é“¾å¼è°ƒç”¨\n### `Promise.prototype.then()`\n\næ¥æ”¶ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå‡ä¸ºå¯é€‰å‚æ•°\n\n```js\nPromise.resolve().then(onFulfilled()=>{}, onReject()={})\n```\n\n### `Promise.prototype.catch()`\n\n#### é”™è¯¯æ•è·æ¡ä»¶\n\nâŒ åœ¨`then`æˆ–`catch`ä¸­ `return` ä¸€ä¸ª `new Error` å¯¹è±¡ä¸ä¼šè¢«æ•è·ï¼š  \n`return new Error(Error!)`  \nâœ… å¿…é¡»ä½¿ç”¨ä»¥ä¸‹ä»»ä¸€ä¸€ç§è¯­æ³•ï¼š\n\n```js\nreturn Promise.reject(new Error(error!!!));\nthrow new Error(error!!!);\n```\n\n#### çº§è”é”™è¯¯\n\n- å¦‚æœåœ¨ Â `catch()`Â  å†…éƒ¨å¼•å‘é”™è¯¯ï¼Œåˆ™å¯ä»¥é™„åŠ ç¬¬äºŒä¸ª Â `catch()`æ¥å¤„ç†ï¼Œä¾æ­¤ç±»æ¨\n\n```js\nnew Promise((resolve, reject) => {\n\tthrow new Error(é”™è¯¯);\n})\n\t.catch((err) => {\n\t\tthrow new Error(é”™è¯¯);\n\t})\n\t.catch((err) => {\n\t\tconsole.error(err);\n\t});\n```\n\n### `Promise.prototype.finally()`\n\n- ç”¨äºæŒ‡å®šä¸ç®¡ Promise å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚è¯¥æ–¹æ³•æ˜¯ ES2018 å¼•å…¥æ ‡å‡†çš„\n  - é¿å…äº†åŒæ ·çš„è¯­å¥éœ€è¦åœ¨`then()`å’Œ`catch()`ä¸­å„å†™ä¸€æ¬¡çš„æƒ…å†µã€‚\n\n### Example (Consume Promise )\n\n#### Example (Promise chain)\n\n```js\n// import fetch from node-fetch;\nconst promise = fetch(https://jsonplaceholder.typicode.com/todos/1);\npromise\n\t.then((res) => res.json())\n\t.then((todo) => {\n\t\tthrow new Error(uh oh);\n\t\treturn todo;\n\t})\n\t.then((todo) => console.log(ğŸ˜›, todo.title)) // This line will be bypasses\n\t.catch((err) => console.error(ğŸ˜­, err));\nconsole.log(ğŸ¥ª Synchronous);\n```\n\n#### Example (Ice-cream Shop)\n\n- [[è‹±å­—] JavaScript å¼‚æ­¥ç¼–ç¨‹ï¼ˆAsync/Awaitã€Promiseã€Callbackï¼‰FreeCodeCamp](https://www.bilibili.com/video/BV1g44y1z7N3/?spm_id_from=333.788.recommend_more_video.4&vd_source=be278a4cfd00a5f72dcf153eaca79333)\n- [FreeCodeCamp-Blog](https://www.freecodecamp.org/news/javascript-async-await-tutorial-learn-callbacks-promises-async-await-by-making-icecream/)\n\n##### Relationship between time and work\n\n```javascript\nlet is_shop_open = true;\nlet order = (time, work) => {\n\treturn new Promise((resolve, reject) => {\n\t\tif (is_shop_open) {\n\t\t\tsetTimeout(() => {\n\t\t\t\t// work is ğŸ‘‡ getting done here\n\t\t\t\tresolve(work());\n\t\t\t\t// Setting ğŸ‘‡ time here for 1 work\n\t\t\t}, time);\n\t\t} else {\n\t\t\treject(console.log(Our shop is closed));\n\t\t}\n\t});\n};\n```\n\n##### Promise chaining\n\n```js\n// step 1\norder(2000, () => console.log(`${stocks.Fruits[0]} was selected`))\n\t// step 2\n\t.then(() => order(0000, () => console.log(production has started)))\n\t// step 3\n\t.then(() => {\n\t\treturn order(2000, () => console.log(Fruit has been chopped));\n\t})\n\t// step 4\n\t.then(() => {\n\t\treturn order(1000, () =>\n\t\t\tconsole.log(`${stocks.liquid[0]} and ${stocks.liquid[1]} added`)\n\t\t);\n\t})\n\t// step 5\n\t.then(() => {\n\t\treturn order(1000, () => console.log(start the machine));\n\t})\n\t// step 6\n\t.then(() => {\n\t\treturn order(2000, () =>\n\t\t\tconsole.log(`ice cream placed on ${stocks.holder[1]}`)\n\t\t);\n\t})\n\t// step 7\n\t.then(() => {\n\t\treturn order(3000, () => console.log(`${stocks.toppings[0]} as toppings`));\n\t})\n\t// Step 8\n\t.then(() => {\n\t\treturn order(2000, () => console.log(Serve Ice Cream));\n\t});\n```\n\n##### Error handling\n\n```javascript\nlet is_shop_open = false;\n// Add Error handling at the end of the Promise chain\n.catch(()=>{\n  console.log(Customer left)\n})\n// Output:\n// Our shop is closed -- from reject\n// Customer left -- from catch\n```\n\n##### TheÂ `.finally`Â handler\n\nTheÂ `finally`Â handler which works regardless of whether our promise was resolved or rejected.\n\n```javascript\n// Whether we serve no customers or 100 customers, our shop will close at the end of the day. Optional - Add `finally` at the very bottom of the chain\n.finally(()=>{\n  console.log(end of day)\n})\n```\n\n#### Avoid Mistakes\n\n```js\ndoSomething()\n\t.then(function (result) {\n\t\t// If using a full function expression: return the promise\n\t\treturn doSomethingElse(result);\n\t})\n\t// If using arrow functions: omit the braces and implicitly return the result\n\t.then((newResult) => doThirdThing(newResult))\n\t// Even if the previous chained promise returns a result, the next one\n\t// doesn't necessarily have to use it. You can pass a handler that doesn't\n\t// consume any result.\n\t.then((/* result ignored */) => doFourthThing())\n\t// Always end the promise chain with a catch handler to avoid any\n\t// unhandled rejections!\n\t.catch((error) => console.error(error));\n```",data={title:"Promise Chaining-é“¾å¼è°ƒç”¨",DateStarted:new Date(17140032e5),draft:!1,tags:["JavaScript"],category:"Programming"},_internal={type:"content",filePath:"E:/SynologyDrive/Codespace/blog-site/mynote/my-fuwari-blog/src/content/posts/js/data-fetching/promise-chaining-é“¾å¼è°ƒç”¨.md",rawData:void 0},html='<h1 id="promise-chaining-é“¾å¼è°ƒç”¨">Promise Chaining-é“¾å¼è°ƒç”¨<a class="anchor" href="#promise-chaining-é“¾å¼è°ƒç”¨"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h1>\n<h3 id="promiseprototypethen"><code>Promise.prototype.then()</code><a class="anchor" href="#promiseprototypethen"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<p>æ¥æ”¶ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå‡ä¸ºå¯é€‰å‚æ•°</p>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#79B8FF">Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">resolve</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">onFulfilled</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">=></span><span style="color:#E1E4E8">{}, </span><span style="color:#B392F0">onReject</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{})</span></span>\n<span class="line"></span></code></pre>\n<h3 id="promiseprototypecatch"><code>Promise.prototype.catch()</code><a class="anchor" href="#promiseprototypecatch"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<h4 id="é”™è¯¯æ•è·æ¡ä»¶">é”™è¯¯æ•è·æ¡ä»¶<a class="anchor" href="#é”™è¯¯æ•è·æ¡ä»¶"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<p>âŒ åœ¨<code>then</code>æˆ–<code>catch</code>ä¸­ <code>return</code> ä¸€ä¸ª <code>new Error</code> å¯¹è±¡ä¸ä¼šè¢«æ•è·ï¼š<br>\n<code>return new Error(Error!)</code><br>\nâœ… å¿…é¡»ä½¿ç”¨ä»¥ä¸‹ä»»ä¸€ä¸€ç§è¯­æ³•ï¼š</p>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">return</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">reject</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Error</span><span style="color:#E1E4E8">(error</span><span style="color:#F97583">!!!</span><span style="color:#E1E4E8">));</span></span>\n<span class="line"><span style="color:#F97583">throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Error</span><span style="color:#E1E4E8">(error</span><span style="color:#F97583">!!!</span><span style="color:#E1E4E8">);</span></span>\n<span class="line"></span></code></pre>\n<h4 id="çº§è”é”™è¯¯">çº§è”é”™è¯¯<a class="anchor" href="#çº§è”é”™è¯¯"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<ul>\n<li>å¦‚æœåœ¨ Â <code>catch()</code>Â  å†…éƒ¨å¼•å‘é”™è¯¯ï¼Œåˆ™å¯ä»¥é™„åŠ ç¬¬äºŒä¸ª Â <code>catch()</code>æ¥å¤„ç†ï¼Œä¾æ­¤ç±»æ¨</li>\n</ul>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">reject</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\tthrow</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Error</span><span style="color:#E1E4E8">(é”™è¯¯);</span></span>\n<span class="line"><span style="color:#E1E4E8">})</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">catch</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">err</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\tthrow</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Error</span><span style="color:#E1E4E8">(é”™è¯¯);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t})</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">catch</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">err</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\tconsole.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(err);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t});</span></span>\n<span class="line"></span></code></pre>\n<h3 id="promiseprototypefinally"><code>Promise.prototype.finally()</code><a class="anchor" href="#promiseprototypefinally"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<ul>\n<li>ç”¨äºæŒ‡å®šä¸ç®¡ Promise å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚è¯¥æ–¹æ³•æ˜¯ ES2018 å¼•å…¥æ ‡å‡†çš„\n<ul>\n<li>é¿å…äº†åŒæ ·çš„è¯­å¥éœ€è¦åœ¨<code>then()</code>å’Œ<code>catch()</code>ä¸­å„å†™ä¸€æ¬¡çš„æƒ…å†µã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id="example-consume-promise-">Example (Consume Promise )<a class="anchor" href="#example-consume-promise-"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<h4 id="example-promise-chain">Example (Promise chain)<a class="anchor" href="#example-promise-chain"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D">// import fetch from node-fetch;</span></span>\n<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> promise</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> fetch</span><span style="color:#E1E4E8">(https:</span><span style="color:#6A737D">//jsonplaceholder.typicode.com/todos/1);</span></span>\n<span class="line"><span style="color:#E1E4E8">promise</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">res</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> res.</span><span style="color:#B392F0">json</span><span style="color:#E1E4E8">())</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">todo</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\tthrow</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Error</span><span style="color:#E1E4E8">(uh oh);</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#E1E4E8"> todo;</span></span>\n<span class="line"><span style="color:#E1E4E8">\t})</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">todo</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(ğŸ˜›, todo.title)) </span><span style="color:#6A737D">// This line will be bypasses</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">catch</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">err</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(ğŸ˜­, err));</span></span>\n<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(ğŸ¥ª Synchronous);</span></span>\n<span class="line"></span></code></pre>\n<h4 id="example-ice-cream-shop">Example (Ice-cream Shop)<a class="anchor" href="#example-ice-cream-shop"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<ul>\n<li><a href="https://www.bilibili.com/video/BV1g44y1z7N3/?spm_id_from=333.788.recommend_more_video.4&#x26;vd_source=be278a4cfd00a5f72dcf153eaca79333">[è‹±å­—] JavaScript å¼‚æ­¥ç¼–ç¨‹ï¼ˆAsync/Awaitã€Promiseã€Callbackï¼‰FreeCodeCamp</a></li>\n<li><a href="https://www.freecodecamp.org/news/javascript-async-await-tutorial-learn-callbacks-promises-async-await-by-making-icecream/">FreeCodeCamp-Blog</a></li>\n</ul>\n<h5 id="relationship-between-time-and-work">Relationship between time and work<a class="anchor" href="#relationship-between-time-and-work"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> is_shop_open </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>\n<span class="line"><span style="color:#F97583">let</span><span style="color:#B392F0"> order</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">time</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">work</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\treturn</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">reject</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\tif</span><span style="color:#E1E4E8"> (is_shop_open) {</span></span>\n<span class="line"><span style="color:#B392F0">\t\t\tsetTimeout</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#6A737D">\t\t\t\t// work is ğŸ‘‡ getting done here</span></span>\n<span class="line"><span style="color:#B392F0">\t\t\t\tresolve</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">work</span><span style="color:#E1E4E8">());</span></span>\n<span class="line"><span style="color:#6A737D">\t\t\t\t// Setting ğŸ‘‡ time here for 1 work</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t\t}, time);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t} </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#B392F0">\t\t\treject</span><span style="color:#E1E4E8">(console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(Our shop is closed));</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t}</span></span>\n<span class="line"><span style="color:#E1E4E8">\t});</span></span>\n<span class="line"><span style="color:#E1E4E8">};</span></span>\n<span class="line"></span></code></pre>\n<h5 id="promise-chaining">Promise chaining<a class="anchor" href="#promise-chaining"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D">// step 1</span></span>\n<span class="line"><span style="color:#B392F0">order</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2000</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`${</span><span style="color:#E1E4E8">stocks</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">Fruits</span><span style="color:#9ECBFF">[</span><span style="color:#79B8FF">0</span><span style="color:#9ECBFF">]</span><span style="color:#9ECBFF">} was selected`</span><span style="color:#E1E4E8">))</span></span>\n<span class="line"><span style="color:#6A737D">\t// step 2</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#B392F0"> order</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0000</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(production has started)))</span></span>\n<span class="line"><span style="color:#6A737D">\t// step 3</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#B392F0"> order</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2000</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(Fruit has been chopped));</span></span>\n<span class="line"><span style="color:#E1E4E8">\t})</span></span>\n<span class="line"><span style="color:#6A737D">\t// step 4</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#B392F0"> order</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`${</span><span style="color:#E1E4E8">stocks</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">liquid</span><span style="color:#9ECBFF">[</span><span style="color:#79B8FF">0</span><span style="color:#9ECBFF">]</span><span style="color:#9ECBFF">} and ${</span><span style="color:#E1E4E8">stocks</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">liquid</span><span style="color:#9ECBFF">[</span><span style="color:#79B8FF">1</span><span style="color:#9ECBFF">]</span><span style="color:#9ECBFF">} added`</span><span style="color:#E1E4E8">)</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t})</span></span>\n<span class="line"><span style="color:#6A737D">\t// step 5</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#B392F0"> order</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(start the machine));</span></span>\n<span class="line"><span style="color:#E1E4E8">\t})</span></span>\n<span class="line"><span style="color:#6A737D">\t// step 6</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#B392F0"> order</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2000</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`ice cream placed on ${</span><span style="color:#E1E4E8">stocks</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">holder</span><span style="color:#9ECBFF">[</span><span style="color:#79B8FF">1</span><span style="color:#9ECBFF">]</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">)</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t})</span></span>\n<span class="line"><span style="color:#6A737D">\t// step 7</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#B392F0"> order</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">3000</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`${</span><span style="color:#E1E4E8">stocks</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">toppings</span><span style="color:#9ECBFF">[</span><span style="color:#79B8FF">0</span><span style="color:#9ECBFF">]</span><span style="color:#9ECBFF">} as toppings`</span><span style="color:#E1E4E8">));</span></span>\n<span class="line"><span style="color:#E1E4E8">\t})</span></span>\n<span class="line"><span style="color:#6A737D">\t// Step 8</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#B392F0"> order</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2000</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(Serve Ice Cream));</span></span>\n<span class="line"><span style="color:#E1E4E8">\t});</span></span>\n<span class="line"></span></code></pre>\n<h5 id="error-handling">Error handling<a class="anchor" href="#error-handling"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> is_shop_open </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>\n<span class="line"><span style="color:#6A737D">// Add Error handling at the end of the Promise chain</span></span>\n<span class="line"><span style="color:#E1E4E8">.</span><span style="color:#B392F0">catch</span><span style="color:#E1E4E8">(()</span><span style="color:#F97583">=></span><span style="color:#E1E4E8">{</span></span>\n<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(Customer left)</span></span>\n<span class="line"><span style="color:#E1E4E8">})</span></span>\n<span class="line"><span style="color:#6A737D">// Output:</span></span>\n<span class="line"><span style="color:#6A737D">// Our shop is closed -- from reject</span></span>\n<span class="line"><span style="color:#6A737D">// Customer left -- from catch</span></span>\n<span class="line"></span></code></pre>\n<h5 id="thefinallyhandler">TheÂ <code>.finally</code>Â handler<a class="anchor" href="#thefinallyhandler"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>\n<p>TheÂ <code>finally</code>Â handler which works regardless of whether our promise was resolved or rejected.</p>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Whether we serve no customers or 100 customers, our shop will close at the end of the day. Optional - Add `finally` at the very bottom of the chain</span></span>\n<span class="line"><span style="color:#E1E4E8">.</span><span style="color:#B392F0">finally</span><span style="color:#E1E4E8">(()</span><span style="color:#F97583">=></span><span style="color:#E1E4E8">{</span></span>\n<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(end </span><span style="color:#F97583">of</span><span style="color:#E1E4E8"> day)</span></span>\n<span class="line"><span style="color:#E1E4E8">})</span></span>\n<span class="line"></span></code></pre>\n<h4 id="avoid-mistakes">Avoid Mistakes<a class="anchor" href="#avoid-mistakes"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#B392F0">doSomething</span><span style="color:#E1E4E8">()</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">function</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">result</span><span style="color:#E1E4E8">) {</span></span>\n<span class="line"><span style="color:#6A737D">\t\t// If using a full function expression: return the promise</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#B392F0"> doSomethingElse</span><span style="color:#E1E4E8">(result);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t})</span></span>\n<span class="line"><span style="color:#6A737D">\t// If using arrow functions: omit the braces and implicitly return the result</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">newResult</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> doThirdThing</span><span style="color:#E1E4E8">(newResult))</span></span>\n<span class="line"><span style="color:#6A737D">\t// Even if the previous chained promise returns a result, the next one</span></span>\n<span class="line"><span style="color:#6A737D">\t// doesn\'t necessarily have to use it. You can pass a handler that doesn\'t</span></span>\n<span class="line"><span style="color:#6A737D">\t// consume any result.</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#6A737D">/* result ignored */</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> doFourthThing</span><span style="color:#E1E4E8">())</span></span>\n<span class="line"><span style="color:#6A737D">\t// Always end the promise chain with a catch handler to avoid any</span></span>\n<span class="line"><span style="color:#6A737D">\t// unhandled rejections!</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">catch</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">error</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(error));</span></span>\n<span class="line"></span></code></pre>',frontmatter={title:"Promise Chaining-é“¾å¼è°ƒç”¨",topic:null,type:"D",tags:["JavaScript"],category:"Programming",Datereviewed:null,reviewed:null,difficulty:null,status:null,comment:null,aliases:["Promise Chaining-é“¾å¼è°ƒç”¨"],draft:!1,DateStarted:"2024-04-25T00:00:00.000Z",DateModified:"2024-04-25T00:00:00.000Z","linter-yaml-title-alias":"Promise Chaining-é“¾å¼è°ƒç”¨",minutes:3,words:566},file="E:/SynologyDrive/Codespace/blog-site/mynote/my-fuwari-blog/src/content/posts/js/data-fetching/promise-chaining-é“¾å¼è°ƒç”¨.md",url=void 0;function rawContent(){return"# Promise Chaining-é“¾å¼è°ƒç”¨\n### `Promise.prototype.then()`\n\næ¥æ”¶ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå‡ä¸ºå¯é€‰å‚æ•°\n\n```js\nPromise.resolve().then(onFulfilled()=>{}, onReject()={})\n```\n\n### `Promise.prototype.catch()`\n\n#### é”™è¯¯æ•è·æ¡ä»¶\n\nâŒ åœ¨`then`æˆ–`catch`ä¸­ `return` ä¸€ä¸ª `new Error` å¯¹è±¡ä¸ä¼šè¢«æ•è·ï¼š  \n`return new Error(Error!)`  \nâœ… å¿…é¡»ä½¿ç”¨ä»¥ä¸‹ä»»ä¸€ä¸€ç§è¯­æ³•ï¼š\n\n```js\nreturn Promise.reject(new Error(error!!!));\nthrow new Error(error!!!);\n```\n\n#### çº§è”é”™è¯¯\n\n- å¦‚æœåœ¨ Â `catch()`Â  å†…éƒ¨å¼•å‘é”™è¯¯ï¼Œåˆ™å¯ä»¥é™„åŠ ç¬¬äºŒä¸ª Â `catch()`æ¥å¤„ç†ï¼Œä¾æ­¤ç±»æ¨\n\n```js\nnew Promise((resolve, reject) => {\n\tthrow new Error(é”™è¯¯);\n})\n\t.catch((err) => {\n\t\tthrow new Error(é”™è¯¯);\n\t})\n\t.catch((err) => {\n\t\tconsole.error(err);\n\t});\n```\n\n### `Promise.prototype.finally()`\n\n- ç”¨äºæŒ‡å®šä¸ç®¡ Promise å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚è¯¥æ–¹æ³•æ˜¯ ES2018 å¼•å…¥æ ‡å‡†çš„\n  - é¿å…äº†åŒæ ·çš„è¯­å¥éœ€è¦åœ¨`then()`å’Œ`catch()`ä¸­å„å†™ä¸€æ¬¡çš„æƒ…å†µã€‚\n\n### Example (Consume Promise )\n\n#### Example (Promise chain)\n\n```js\n// import fetch from node-fetch;\nconst promise = fetch(https://jsonplaceholder.typicode.com/todos/1);\npromise\n\t.then((res) => res.json())\n\t.then((todo) => {\n\t\tthrow new Error(uh oh);\n\t\treturn todo;\n\t})\n\t.then((todo) => console.log(ğŸ˜›, todo.title)) // This line will be bypasses\n\t.catch((err) => console.error(ğŸ˜­, err));\nconsole.log(ğŸ¥ª Synchronous);\n```\n\n#### Example (Ice-cream Shop)\n\n- [[è‹±å­—] JavaScript å¼‚æ­¥ç¼–ç¨‹ï¼ˆAsync/Awaitã€Promiseã€Callbackï¼‰FreeCodeCamp](https://www.bilibili.com/video/BV1g44y1z7N3/?spm_id_from=333.788.recommend_more_video.4&vd_source=be278a4cfd00a5f72dcf153eaca79333)\n- [FreeCodeCamp-Blog](https://www.freecodecamp.org/news/javascript-async-await-tutorial-learn-callbacks-promises-async-await-by-making-icecream/)\n\n##### Relationship between time and work\n\n```javascript\nlet is_shop_open = true;\nlet order = (time, work) => {\n\treturn new Promise((resolve, reject) => {\n\t\tif (is_shop_open) {\n\t\t\tsetTimeout(() => {\n\t\t\t\t// work is ğŸ‘‡ getting done here\n\t\t\t\tresolve(work());\n\t\t\t\t// Setting ğŸ‘‡ time here for 1 work\n\t\t\t}, time);\n\t\t} else {\n\t\t\treject(console.log(Our shop is closed));\n\t\t}\n\t});\n};\n```\n\n##### Promise chaining\n\n```js\n// step 1\norder(2000, () => console.log(`${stocks.Fruits[0]} was selected`))\n\t// step 2\n\t.then(() => order(0000, () => console.log(production has started)))\n\t// step 3\n\t.then(() => {\n\t\treturn order(2000, () => console.log(Fruit has been chopped));\n\t})\n\t// step 4\n\t.then(() => {\n\t\treturn order(1000, () =>\n\t\t\tconsole.log(`${stocks.liquid[0]} and ${stocks.liquid[1]} added`)\n\t\t);\n\t})\n\t// step 5\n\t.then(() => {\n\t\treturn order(1000, () => console.log(start the machine));\n\t})\n\t// step 6\n\t.then(() => {\n\t\treturn order(2000, () =>\n\t\t\tconsole.log(`ice cream placed on ${stocks.holder[1]}`)\n\t\t);\n\t})\n\t// step 7\n\t.then(() => {\n\t\treturn order(3000, () => console.log(`${stocks.toppings[0]} as toppings`));\n\t})\n\t// Step 8\n\t.then(() => {\n\t\treturn order(2000, () => console.log(Serve Ice Cream));\n\t});\n```\n\n##### Error handling\n\n```javascript\nlet is_shop_open = false;\n// Add Error handling at the end of the Promise chain\n.catch(()=>{\n  console.log(Customer left)\n})\n// Output:\n// Our shop is closed -- from reject\n// Customer left -- from catch\n```\n\n##### TheÂ `.finally`Â handler\n\nTheÂ `finally`Â handler which works regardless of whether our promise was resolved or rejected.\n\n```javascript\n// Whether we serve no customers or 100 customers, our shop will close at the end of the day. Optional - Add `finally` at the very bottom of the chain\n.finally(()=>{\n  console.log(end of day)\n})\n```\n\n#### Avoid Mistakes\n\n```js\ndoSomething()\n\t.then(function (result) {\n\t\t// If using a full function expression: return the promise\n\t\treturn doSomethingElse(result);\n\t})\n\t// If using arrow functions: omit the braces and implicitly return the result\n\t.then((newResult) => doThirdThing(newResult))\n\t// Even if the previous chained promise returns a result, the next one\n\t// doesn't necessarily have to use it. You can pass a handler that doesn't\n\t// consume any result.\n\t.then((/* result ignored */) => doFourthThing())\n\t// Always end the promise chain with a catch handler to avoid any\n\t// unhandled rejections!\n\t.catch((error) => console.error(error));\n```"}function compiledContent(){return html}function getHeadings(){return[{depth:1,slug:"promise-chaining-é“¾å¼è°ƒç”¨",text:"Promise Chaining-é“¾å¼è°ƒç”¨#"},{depth:3,slug:"promiseprototypethen",text:"Promise.prototype.then()#"},{depth:3,slug:"promiseprototypecatch",text:"Promise.prototype.catch()#"},{depth:4,slug:"é”™è¯¯æ•è·æ¡ä»¶",text:"é”™è¯¯æ•è·æ¡ä»¶#"},{depth:4,slug:"çº§è”é”™è¯¯",text:"çº§è”é”™è¯¯#"},{depth:3,slug:"promiseprototypefinally",text:"Promise.prototype.finally()#"},{depth:3,slug:"example-consume-promise-",text:"Example (Consume Promise )#"},{depth:4,slug:"example-promise-chain",text:"Example (Promise chain)#"},{depth:4,slug:"example-ice-cream-shop",text:"Example (Ice-cream Shop)#"},{depth:5,slug:"relationship-between-time-and-work",text:"Relationship between time and work#"},{depth:5,slug:"promise-chaining",text:"Promise chaining#"},{depth:5,slug:"error-handling",text:"Error handling#"},{depth:5,slug:"thefinallyhandler",text:"TheÂ .finallyÂ handler#"},{depth:4,slug:"avoid-mistakes",text:"Avoid Mistakes#"}]}const Content=createComponent(((s,n,e)=>{const{layout:o,...a}=frontmatter;return a.file=file,a.url=url,renderTemplate`${maybeRenderHead()}${unescapeHTML(html)}`})),promiseChaining_____=Object.freeze(Object.defineProperty({__proto__:null,Content:Content,compiledContent:compiledContent,default:Content,file:file,frontmatter:frontmatter,getHeadings:getHeadings,rawContent:rawContent,url:url},Symbol.toStringTag,{value:"Module"}));export{_internal,body,collection,data,id,promiseChaining_____,slug};