import{createComponent,renderTemplate,maybeRenderHead,unescapeHTML}from"../../../../chunks/1713773016041/astro.mjs";import"kleur/colors";import"clsx";import"html-escaper";import"cssesc";const id="js/data-fetching/promise.md",collection="posts",slug="js/data-fetching/promise",body="\n# Promise\n\n## Reference\n\n- â­[é€šä¿—æ˜“æ‡‚çš„ Promise çŸ¥è¯†ç‚¹æ€»ç»“ï¼Œæ£€éªŒä¸€ä¸‹ä½ æ˜¯å¦çœŸçš„å®Œå…¨æŒæ¡äº† Promiseï¼Ÿ - æ˜é‡‘](https://juejin.cn/post/7020335414980378655)\n  - [Promise - JavaScript | MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)\n  - [Using Promises - JavaScript | MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises)\n- [ä½ å¥½ï¼ŒJavaScript å¼‚æ­¥ç¼–ç¨‹---- ç†è§£ JavaScript å¼‚æ­¥çš„ç¾å¦™](https://juejin.cn/post/6844903648162480142 https://juejin.cn/post/6844903648162480142)\n- [Promise ä¸ä¼šï¼Ÿï¼Ÿçœ‹è¿™é‡Œï¼ï¼ï¼å²ä¸Šæœ€é€šä¿—æ˜“æ‡‚çš„ Promiseï¼ï¼ï¼](https://juejin.cn/post/6844903607968481287 https://juejin.cn/post/6844903607968481287)\n- [å½“ async/await é‡ä¸Š forEach](https://link.juejin.cn?target=https%3A%2F%2Fobjcer.com%2F2017%2F10%2F12%2Fasync-await-with-forEach%2F https://objcer.com/2017/10/12/async-await-with-forEach/)\n- [Promise å¿…çŸ¥å¿…ä¼šï¼ˆåé“é¢˜ï¼‰](https://juejin.cn/post/6844903509934997511 https://juejin.cn/post/6844903509934997511)\n\n### Write a Promise\n\n- â­[Promises/A+](https://promisesaplus.com/)\n  - ğŸ› ï¸[Conformant Promises/A+ Implementations](https://promisesaplus.com/implementations)\n  - ğŸ› ï¸[Promises/A+ Â· GitHub](https://github.com/promises-aplus)\n- ğŸš€[æ‰‹å†™ Promiseï¼šå®ç°ç¬¦åˆ Promises/A+è§„èŒƒçš„ Promise - æ˜é‡‘](https://juejin.cn/post/7274887531271012388#heading-13)\n- ğŸš€[æ‰‹å†™ Promise æ ¸å¿ƒä»£ç  - JavaScript å‰ç«¯ Web å·¥ç¨‹å¸ˆ\\_å“”å“©å“”å“©\\_bilibili](https://www.bilibili.com/video/BV1RR4y1p7my/?vd_source=be278a4cfd00a5f72dcf153eaca79333)\n  - [æ‰‹æŠŠæ‰‹ä¸€è¡Œä¸€è¡Œä»£ç æ•™ä½ â€œæ‰‹å†™ Promiseâ€œï¼Œå®Œç¾é€šè¿‡ Promises/A+ å®˜æ–¹ 872 ä¸ªæµ‹è¯•ç”¨ä¾‹ - æ˜é‡‘](https://juejin.cn/post/7043758954496655397#heading-14)\n- [Promise å®ç°åŸç†ï¼ˆé™„æºç ï¼‰](https://juejin.cn/post/6844903665686282253 https://juejin.cn/post/6844903665686282253)\n- [100 è¡Œä»£ç å®ç° Promises/A+ è§„èŒƒ](https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqdJ0Xd8zTgtetFdlJL3P1g https://mp.weixin.qq.com/s/qdJ0Xd8zTgtetFdlJL3P1g)\n- [ä¸€èµ·å­¦ä¹ é€ è½®å­ï¼ˆä¸€ï¼‰ï¼šä»é›¶å¼€å§‹å†™ä¸€ä¸ªç¬¦åˆ Promises/A+è§„èŒƒçš„ promise](https://juejin.cn/post/6844903617619558408#heading-34 https://juejin.cn/post/6844903617619558408#heading-34)\n- [BAT å‰ç«¯ç»å…¸é¢è¯•é—®é¢˜ï¼šå²ä¸Šæœ€æœ€æœ€è¯¦ç»†çš„æ‰‹å†™ Promise æ•™ç¨‹](https://juejin.cn/post/6844903625769091079#heading-9 https://juejin.cn/post/6844903625769091079#heading-9)\n\n## What is a Promise?\n\n- A promise is a returned **object** to which you attach callbacks, instead of passing callbacks into a function.\n- It represents the eventual completion (or failure) of an asynchronous operation and its resulting value.\n- Promise æ˜¯ä¸€ç§å¤„ç†å¼‚æ­¥ä»£ç ï¼ˆè€Œä¸ä¼šé™·å…¥å›è°ƒåœ°ç‹±ï¼‰çš„æ–¹å¼ã€‚\n\n## Promise State & Result\n\n#### 3 ç§çŠ¶æ€ (PromiseState)\n\n- **pending**: initial state, neither fulfilled nor rejected.\n- **fulfilled** (resolved): meaning that the operation was completed successfully.\n- **rejected**: meaning that the operation failed\n- ![](https://cdn.jsdelivr.net/gh/jenniferwonder/bimg/programming/z-PromiseState-1.png) ![](https://cdn.jsdelivr.net/gh/jenniferwonder/bimg/programming/z-PromiseState.png)\n\n#### æ‰§è¡Œç‰¹ç‚¹\n\n- Promise åªä»¥`ç¬¬ä¸€æ¬¡ä¸ºå‡†`ï¼Œç¬¬ä¸€æ¬¡æˆåŠŸå°±`æ°¸ä¹…`ä¸º`fulfilled`ï¼Œç¬¬ä¸€æ¬¡å¤±è´¥å°±æ°¸è¿œçŠ¶æ€ä¸º`rejected`\n- Promise ä¸­æœ‰ `throw` çš„è¯ï¼Œå°±ç›¸å½“äºæ‰§è¡Œäº†`reject`\n\n```js\nlet p1 = new Promise((resolve, reject) => {\n\tresolve(æˆåŠŸ);\n\treject(å¤±è´¥);\n});\nconsole.log(p1, p1);\n\nlet p2 = new Promise((resolve, reject) => {\n\treject(å¤±è´¥);\n\tresolve(æˆåŠŸ);\n});\nconsole.log(p2, p2);\n\nlet p3 = new Promise((resolve, reject) => {\n\tthrow æŠ¥é”™;\n});\nconsole.log(p3, p3);\n```\n\n#### Pending State ç‰¹ç‚¹\n\n- Promise é‡Œæ²¡æœ‰æ‰§è¡Œ`resolve`ã€`reject`ä»¥åŠ`throw`çš„è¯ï¼Œè¿™ä¸ª promise çš„çŠ¶æ€ä¹Ÿæ˜¯`pending`\n- `pending`çŠ¶æ€ä¸‹çš„ promise ä¸ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°`then()`\n\n```js\nlet myPromise1 = new Promise(() => {});\nconsole.log(myPromise1 :>> , myPromise1);\nlet myPromise2 = new Promise((resolve, reject) => {\n\tlet a = 1;\n\tfor (let index = 0; index < 5; index++) {\n\t\ta++;\n\t}\n});\nconsole.log(myPromise2 :>> , myPromise2);\nmyPromise2.then(() => {\n\tconsole.log(myPromise2æ‰§è¡Œäº†then); // åœ¨ Promise pending çŠ¶æ€ä¸‹ä¸ä¼šæ‰§è¡Œ\n});\n```\n\n## Create a Promise\n\n### `new Promise()`\n\n#### å‚æ•°è¦æ±‚\n\n- ä½¿ç”¨ `new Promise()` å¿…é¡»è¾“å…¥ä¸€ä¸ªæ‰§è¡Œå‡½æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™\n\n```js\nlet myPromise0 = new Promise();\nconsole.log(myPromise0 :>> , myPromise0); // æŠ¥é”™ï¼šTypeError: Promise resolver undefined\n```\n\n##### Case\n\n```js\nfunction makeRequest(location) {\n\treturn new Promise((resolve, reject) => {\n\t\tconsole.log(`Making Request to ${location}`);\n\t\tif (location === Google) {\n\t\t\tresolve(Google says Hi);\n\t\t} else {\n\t\t\treject(We can only talk to Google);\n\t\t}\n\t});\n}\n```\n\n#### â­ æ‰§è¡Œé¡ºåº\n\n- Promise æ„é€ å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œ`promise.then`Â  ä¸­çš„å‡½æ•°æ˜¯å¼‚æ­¥æ‰§è¡Œçš„\n\n##### Case\n\n```js\nconst promise = new Promise((resolve, reject) => {\n\tconsole.log(1);\n\tresolve();\n\tconsole.log(2);\n});\npromise.then(() => {\n\tconsole.log(3);\n});\nconsole.log(4);\n```\n\n##### Output\n\n```shell\n1\n2\n4\n3\n```\n\n### `Promise.resolve()`\n\nå°†ç°æœ‰å¯¹è±¡è½¬ä¸º Promise å¯¹è±¡\n\n```js\nPromise.resolve(foo);\n// ç­‰ä»·äº\nnew Promise((resolve) => resolve(foo));\n```\n\n#### å‚æ•°çš„å››ç§æƒ…å†µ\n\n1. å¦‚æœå‚æ•°æ˜¯ `Promise` å®ä¾‹\n   - é‚£ä¹ˆ `Promise.resolve()` å°†ä¸åšä»»ä½•ä¿®æ”¹ã€åŸå°ä¸åŠ¨åœ°è¿”å›è¿™ä¸ªå®ä¾‹ã€‚\n2. å‚æ•°æ˜¯ä¸€ä¸ª thenable (å…·æœ‰`then`æ–¹æ³•çš„å¯¹è±¡) å¯¹è±¡\n   - ä¼šå°†è¿™ä¸ªå¯¹è±¡è½¬ä¸º `Promise` å¯¹è±¡ï¼Œç„¶åå°±ç«‹å³æ‰§è¡Œ thenable å¯¹è±¡çš„ `then`æ–¹æ³•\n3. å‚æ•°æ˜¯ä¸€ä¸ªåŸå§‹å€¼ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªä¸å…·æœ‰`then`æ–¹æ³•çš„å¯¹è±¡\n   - åˆ™`Promise.resolve`æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ Â `Promise`Â  å¯¹è±¡ï¼ŒçŠ¶æ€ä¸º`resolved`\n4. `Promise.resolve()`æ–¹æ³•å…è®¸è°ƒç”¨æ—¶ä¸å¸¦å‚æ•°\n   - ç›´æ¥è¿”å›ä¸€ä¸ª `resolved`çŠ¶æ€çš„ `Promise` å¯¹è±¡ã€‚\n\n#### Example\n\n```js\nconst tick = Date.now();\nconst log = (v) => console.log(`${v} \\n Elapsed: ${Date.now() - tick}ms`);\nconst codeBlocker = () => {\n\t// Blocking\n\t// let i = 0;\n\t// while(i < 1000000000) { i++;}\n\t// return 'ğŸ· billion loops done';\n\n\t// Async blocking\n\t// return new Promise((resolve, reject) => {\n\t// let i = 0;\n\t// while(i < 1000000000) { i++;}\n\t// resolve('ğŸ· billion loops done');\n\t// })\n\n\t// Non-blocking\n\treturn Promise.resolve().then((v) => {\n\t\tlet i = 0;\n\t\twhile (i < 1000000000) {\n\t\t\ti++;\n\t\t}\n\t\treturn ğŸ· billion loops done;\n\t});\n};\nlog(ğŸ¥ª Synchronous 1);\ncodeBlocker().then(log);\nlog(ğŸ¥ª Synchronous 2);\n```\n\n### `Promise.reject()`\n\n- `Promise.reject()`æ–¹æ³•çš„å‚æ•°ï¼Œä¼šåŸå°ä¸åŠ¨åœ°ä½œä¸º`reject`çš„ç†ç”±ï¼Œå˜æˆåç»­æ–¹æ³•çš„å‚æ•°\n\n```js\nconst thenable = {\n\tthen(resolve, reject) {\n\t\treject(å‡ºé”™äº†);\n\t},\n};\nPromise.reject(thenable).catch((e) => {\n\tconsole.log(e === thenable);\n});\n// true\n```\n\n## Consume Promise\n\n### `Promise.prototype.then()`\n\næ¥æ”¶ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå‡ä¸ºå¯é€‰å‚æ•°\n\n```js\nPromise.resolve().then(onFulfilled()=>{}, onReject()={})\n```\n\n### `Promise.prototype.catch()`\n\n#### é”™è¯¯æ•è·æ¡ä»¶\n\nâŒ åœ¨`then`æˆ–`catch`ä¸­ `return` ä¸€ä¸ª `new Error` å¯¹è±¡ä¸ä¼šè¢«æ•è·ï¼š\n`return new Error(Error!)`\nâœ… å¿…é¡»ä½¿ç”¨ä»¥ä¸‹ä»»ä¸€ä¸€ç§è¯­æ³•ï¼š\n\n```js\nreturn Promise.reject(new Error(error!!!));\nthrow new Error(error!!!);\n```\n\n#### çº§è”é”™è¯¯\n\n- å¦‚æœåœ¨ Â `catch()`Â  å†…éƒ¨å¼•å‘é”™è¯¯ï¼Œåˆ™å¯ä»¥é™„åŠ ç¬¬äºŒä¸ª Â `catch()`æ¥å¤„ç†ï¼Œä¾æ­¤ç±»æ¨\n\n```js\nnew Promise((resolve, reject) => {\n\tthrow new Error(é”™è¯¯);\n})\n\t.catch((err) => {\n\t\tthrow new Error(é”™è¯¯);\n\t})\n\t.catch((err) => {\n\t\tconsole.error(err);\n\t});\n```\n\n### `Promise.prototype.finally()`\n\n- ç”¨äºæŒ‡å®šä¸ç®¡ Promise å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚è¯¥æ–¹æ³•æ˜¯ ES2018 å¼•å…¥æ ‡å‡†çš„\n  - é¿å…äº†åŒæ ·çš„è¯­å¥éœ€è¦åœ¨`then()`å’Œ`catch()`ä¸­å„å†™ä¸€æ¬¡çš„æƒ…å†µã€‚\n\n### Example (Consume Promise )\n\n#### Example (Promise chain)\n\n```js\n// import fetch from node-fetch;\nconst promise = fetch(https://jsonplaceholder.typicode.com/todos/1);\npromise\n\t.then((res) => res.json())\n\t.then((todo) => {\n\t\tthrow new Error(uh oh);\n\t\treturn todo;\n\t})\n\t.then((todo) => console.log(ğŸ˜›, todo.title)) // This line will be bypasses\n\t.catch((err) => console.error(ğŸ˜­, err));\nconsole.log(ğŸ¥ª Synchronous);\n```\n\n#### Example (Ice-cream Shop)\n\n- [[è‹±å­—] JavaScript å¼‚æ­¥ç¼–ç¨‹ï¼ˆAsync/Awaitã€Promiseã€Callbackï¼‰FreeCodeCamp](https://www.bilibili.com/video/BV1g44y1z7N3/?spm_id_from=333.788.recommend_more_video.4&vd_source=be278a4cfd00a5f72dcf153eaca79333)\n- [FreeCodeCamp-Blog](https://www.freecodecamp.org/news/javascript-async-await-tutorial-learn-callbacks-promises-async-await-by-making-icecream/)\n\n##### Relationship between time and work\n\n```javascript\nlet is_shop_open = true;\nlet order = (time, work) => {\n\treturn new Promise((resolve, reject) => {\n\t\tif (is_shop_open) {\n\t\t\tsetTimeout(() => {\n\t\t\t\t// work is ğŸ‘‡ getting done here\n\t\t\t\tresolve(work());\n\t\t\t\t// Setting ğŸ‘‡ time here for 1 work\n\t\t\t}, time);\n\t\t} else {\n\t\t\treject(console.log(Our shop is closed));\n\t\t}\n\t});\n};\n```\n\n##### Promise chaining\n\n```js\n// step 1\norder(2000, () => console.log(`${stocks.Fruits[0]} was selected`))\n\t// step 2\n\t.then(() => order(0000, () => console.log(production has started)))\n\t// step 3\n\t.then(() => {\n\t\treturn order(2000, () => console.log(Fruit has been chopped));\n\t})\n\t// step 4\n\t.then(() => {\n\t\treturn order(1000, () =>\n\t\t\tconsole.log(`${stocks.liquid[0]} and ${stocks.liquid[1]} added`)\n\t\t);\n\t})\n\t// step 5\n\t.then(() => {\n\t\treturn order(1000, () => console.log(start the machine));\n\t})\n\t// step 6\n\t.then(() => {\n\t\treturn order(2000, () =>\n\t\t\tconsole.log(`ice cream placed on ${stocks.holder[1]}`)\n\t\t);\n\t})\n\t// step 7\n\t.then(() => {\n\t\treturn order(3000, () => console.log(`${stocks.toppings[0]} as toppings`));\n\t})\n\t// Step 8\n\t.then(() => {\n\t\treturn order(2000, () => console.log(Serve Ice Cream));\n\t});\n```\n\n##### Error handling\n\n```javascript\nlet is_shop_open = false;\n// Add Error handling at the end of the Promise chain\n.catch(()=>{\n  console.log(Customer left)\n})\n// Output:\n// Our shop is closed -- from reject\n// Customer left -- from catch\n```\n\n##### TheÂ `.finally`Â handler\n\nTheÂ `finally`Â handler which works regardless of whether our promise was resolved or rejected.\n\n```javascript\n// Whether we serve no customers or 100 customers, our shop will close at the end of the day. Optional - Add `finally` at the very bottom of the chain\n.finally(()=>{\n  console.log(end of day)\n})\n```\n\n#### Avoid Mistakes\n\n```js\ndoSomething()\n\t.then(function (result) {\n\t\t// If using a full function expression: return the promise\n\t\treturn doSomethingElse(result);\n\t})\n\t// If using arrow functions: omit the braces and implicitly return the result\n\t.then((newResult) => doThirdThing(newResult))\n\t// Even if the previous chained promise returns a result, the next one\n\t// doesn't necessarily have to use it. You can pass a handler that doesn't\n\t// consume any result.\n\t.then((/* result ignored */) => doFourthThing())\n\t// Always end the promise chain with a catch handler to avoid any\n\t// unhandled rejections!\n\t.catch((error) => console.error(error));\n```\n\n## More Promise Method (æ›´å¤š Promise å¯¹è±¡æ–¹æ³•)\n\n### `Promise.all()`\n\n- å‘èµ·å¤šä¸ªå¹¶å‘è¯·æ±‚ï¼Œç„¶ååœ¨æ‰€æœ‰ promise éƒ½è¢«è§£å†³åæ‰§è¡Œä¸€äº›æ“ä½œ\n- é€‚åˆå½¼æ­¤ç›¸äº’ä¾èµ–æˆ–è€…åœ¨å…¶ä¸­ä»»ä½•ä¸€ä¸ª`reject`æ—¶ç«‹å³ç»“æŸ\n\n```js\nconst promise1 = Promise.resolve(3);\nconst promise2 = 42;\nconst promise3 = new Promise((resolve, reject) => {\n\tsetTimeout(resolve, 100, foo);\n});\nPromise.all([promise1, promise2, promise3]).then((values) => {\n\tconsole.log(values);\n});\n// expected output: Array [3, 42, foo]\n```\n\n### `Promise.race()`\n\n- ä¼ å…¥å¤šä¸ª promise å®ä¾‹ï¼Œè°è·‘çš„å¿«ï¼Œå°±ä»¥è°çš„ç»“æœæ‰§è¡Œå›è°ƒ\n\n```js\nconst first = new Promise((resolve, reject) => {\n\tsetTimeout(resolve, 500, ç¬¬ä¸€ä¸ª);\n});\nconst second = new Promise((resolve, reject) => {\n\tsetTimeout(resolve, 100, ç¬¬äºŒä¸ª);\n});\nPromise.race([first, second]).then((result) => {\n\tconsole.log(result); // ç¬¬äºŒä¸ª\n});\n```\n\n#### Use Case\n\n1ã€æŠŠå¼‚æ­¥æ“ä½œå’Œå®šæ—¶å™¨æ”¾åˆ°ä¸€èµ·ï¼Œå¦‚æœå®šæ—¶å™¨å…ˆè§¦å‘ï¼Œè®¤ä¸ºè¶…æ—¶ï¼Œå‘ŠçŸ¥ç”¨æˆ·\n\n```js\nfunction timeOut(time) {\n\tlet result = new Promise((resolve, reject) => {\n\t\tsetTimeout(() => {\n\t\t\tresolve(è¯·æ±‚è¶…æ—¶);\n\t\t}, time); // ä¸ºäº†éªŒè¯æ–¹æ³•ï¼Œå¯ä»¥æŠŠæ—¶é—´è®¾å°ç‚¹\n\t});\n\treturn result;\n}\nPromise.race([timeOut(200), fetch(https://api.github.com/users/ruanyf)]).then(\n\t(res) => {\n\t\tconsole.log(res);\n\t}\n);\n```\n\n2ã€å¦‚æœå›¾ç‰‡ç­‰èµ„æºæœ‰å¤šä¸ªå­˜æ”¾è·¯å¾„ï¼Œä½†æ˜¯ä¸ç¡®å®šå“ªä¸ªè·¯å¾„çš„èµ„æºæ›´å¿«ï¼Œå¯ä»¥ç”¨è¯¥æ–¹æ³•åŒæ—¶è¯·æ±‚å¤šä¸ªè·¯å¾„ï¼Œå“ªä¸ªè·¯å¾„çš„èµ„æºæœ€å…ˆæ‹¿åˆ°ï¼Œä½¿ç”¨å“ªä¸ªèµ„æº\n\n3ã€å¦‚æœæŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è·å¾—ç»“æœï¼Œå°±å°† Promise çš„çŠ¶æ€å˜ä¸º `reject`ï¼Œå¦åˆ™å˜ä¸º`resolve`\n\n```js\nconst p = Promise.race([\n\tfetch(/resource-that-may-take-a-while),\n\tnew Promise(function (resolve, reject) {\n\t\tsetTimeout(() => reject(new Error(request timeout)), 5000);\n\t}),\n]);\np.then(console.log).catch(console.error);\n```\n\n### `Promise.allSettled()` (ES2020)\n\n- ç”± ES2020 å¼•å…¥\n- åŠŸèƒ½\n  - æœ‰å¤šä¸ªå½¼æ­¤ä¸ä¾èµ–çš„å¼‚æ­¥ä»»åŠ¡æˆåŠŸå®Œæˆæ—¶ï¼Œæˆ–è€…æ‚¨æ€»æ˜¯æƒ³çŸ¥é“æ¯ä¸ª promise çš„ç»“æœæ—¶ï¼Œé€šå¸¸ä½¿ç”¨\n  - `Promise.all()`æ— æ³•ç¡®å®šæ‰€æœ‰è¯·æ±‚éƒ½ç»“æŸã€‚æƒ³è¦è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œå†™èµ·æ¥å¾ˆéº»çƒ¦ï¼Œæœ‰äº†`Promise.allSettled()`ï¼Œè¿™å°±å¾ˆå®¹æ˜“äº†\n\n```js\nconst urls = [\n\t/* ... */\n];\nconst requests = urls.map((x) => fetch(x));\ntry {\n\tawait Promise.all(requests);\n\tconsole.log(æ‰€æœ‰è¯·æ±‚éƒ½æˆåŠŸã€‚);\n} catch {\n\tconsole.log(è‡³å°‘ä¸€ä¸ªè¯·æ±‚å¤±è´¥ï¼Œå…¶ä»–è¯·æ±‚å¯èƒ½è¿˜æ²¡ç»“æŸã€‚);\n}\n```\n\n#### è¿”å›å€¼\n\n- è¿”å›ä¸€ä¸ªåœ¨æ‰€æœ‰ç»™å®šçš„ promise éƒ½å·²ç»`fulfilled`æˆ–`rejected`åçš„ promiseï¼Œå¹¶å¸¦æœ‰ä¸€ä¸ª**å¯¹è±¡æ•°ç»„**ï¼Œæ¯ä¸ªå¯¹è±¡è¡¨ç¤ºå¯¹åº”çš„ promise ç»“æœ\n  - ![](https://cdn.jsdelivr.net/gh/jenniferwonder/bimg/programming/z-Promise.allSettled.png)\n- æ¯ä¸ªå¯¹è±¡éƒ½æœ‰`status`å±æ€§ï¼Œè¯¥å±æ€§çš„å€¼åªå¯èƒ½æ˜¯å­—ç¬¦ä¸²`fulfilled`æˆ–å­—ç¬¦ä¸²`rejected`ã€‚\n  - `fulfilled`æ—¶ï¼Œå¯¹è±¡æœ‰`value`å±æ€§ï¼Œ\n  - `rejected`æ—¶æœ‰`reason`å±æ€§ï¼Œå¯¹åº”ä¸¤ç§çŠ¶æ€çš„è¿”å›å€¼ã€‚\n\n```js\nconst promises = [fetch(index.html), fetch(https://does-not-exist/)];\nconst results = await Promise.allSettled(promises);\n// è¿‡æ»¤å‡ºæˆåŠŸçš„è¯·æ±‚\nconst successfulPromises = results.filter((p) => p.status === fulfilled);\n// è¿‡æ»¤å‡ºå¤±è´¥çš„è¯·æ±‚ï¼Œå¹¶è¾“å‡ºåŸå› \nconst errors = results\n\t.filter((p) => p.status === rejected)\n\t.map((p) => p.reason);\n```\n\n### `Promise.any()` (ES2020)\n\n- è¾“å…¥\n  - ä¸€ä¸ª Promise æ•°ç»„\n- è¿”å›å€¼\n  - ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡\n    - è¯¥ Promise å¯¹è±¡åœ¨ä¼ å…¥çš„ Promise æ•°ç»„ä¸­çš„ä»»ä½•ä¸€ä¸ª Promise è§£å†³æ—¶å°±ä¼šè¢«è§£å†³\n    - è‹¥æ‰€æœ‰çš„ Promise éƒ½è¢«æ‹’ç»ï¼Œåˆ™è¿”å›çš„ Promise ä¼šè¢«æ‹’ç»ï¼Œå¹¶ä¸”å®ƒçš„æ‹’å› æ˜¯ä¸€ä¸ª `AggregateError` å¯¹è±¡å®ä¾‹ï¼ŒåŒ…å«äº†æ‰€æœ‰è¢«æ‹’ç»çš„ Promise çš„åŸå›  (å¯é€šè¿‡ `.errors` å±æ€§è¯»å–)\n- è¿”å›å€¼å¤„ç†\n\n```js\nPromise.any([p10, p11])\n\t.then((res) => console.log(res))\n\t.catch((err) => {\n\t\tif (err instanceof AggregateError) {\n\t\t\tconsole.error(AggregateError occurred:);\n\t\t\tconsole.log(err.errors);\n\t\t\terr.errors.forEach((err, index) => {\n\t\t\t\tconsole.error(`Error ${index + 1}:`, err);\n\t\t\t});\n\t\t} else {\n\t\t\tconsole.error(Other error occurred:, err);\n\t\t}\n\t});\n```\n",data={title:"Promise",DateStarted:new Date(1670544e6),draft:!0,tags:["JavaScript"],category:"Programming"},_internal={type:"content",filePath:"E:/SynologyDrive/Codespace/blog-site/mynote/my-fuwari-blog/src/content/posts/js/data-fetching/promise.md",rawData:void 0},html='<h1 id="promise">Promise<a class="anchor" href="#promise"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h1>\n<h2 id="reference">Reference<a class="anchor" href="#reference"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2>\n<ul>\n<li>â­<a href="https://juejin.cn/post/7020335414980378655">é€šä¿—æ˜“æ‡‚çš„ Promise çŸ¥è¯†ç‚¹æ€»ç»“ï¼Œæ£€éªŒä¸€ä¸‹ä½ æ˜¯å¦çœŸçš„å®Œå…¨æŒæ¡äº† Promiseï¼Ÿ - æ˜é‡‘</a>\n<ul>\n<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise - JavaScript | MDN</a></li>\n<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises">Using Promises - JavaScript | MDN</a></li>\n</ul>\n</li>\n<li>[ä½ å¥½ï¼ŒJavaScript å¼‚æ­¥ç¼–ç¨‹---- ç†è§£ JavaScript å¼‚æ­¥çš„ç¾å¦™](<a href="https://juejin.cn/post/6844903648162480142">https://juejin.cn/post/6844903648162480142</a> <a href="https://juejin.cn/post/6844903648162480142">https://juejin.cn/post/6844903648162480142</a>)</li>\n<li>[Promise ä¸ä¼šï¼Ÿï¼Ÿçœ‹è¿™é‡Œï¼ï¼ï¼å²ä¸Šæœ€é€šä¿—æ˜“æ‡‚çš„ Promiseï¼ï¼ï¼](<a href="https://juejin.cn/post/6844903607968481287">https://juejin.cn/post/6844903607968481287</a> <a href="https://juejin.cn/post/6844903607968481287">https://juejin.cn/post/6844903607968481287</a>)</li>\n<li>[å½“ async/await é‡ä¸Š forEach](<a href="https://link.juejin.cn?target=https%3A%2F%2Fobjcer.com%2F2017%2F10%2F12%2Fasync-await-with-forEach%2F">https://link.juejin.cn?target=https%3A%2F%2Fobjcer.com%2F2017%2F10%2F12%2Fasync-await-with-forEach%2F</a> <a href="https://objcer.com/2017/10/12/async-await-with-forEach/">https://objcer.com/2017/10/12/async-await-with-forEach/</a>)</li>\n<li>[Promise å¿…çŸ¥å¿…ä¼šï¼ˆåé“é¢˜ï¼‰](<a href="https://juejin.cn/post/6844903509934997511">https://juejin.cn/post/6844903509934997511</a> <a href="https://juejin.cn/post/6844903509934997511">https://juejin.cn/post/6844903509934997511</a>)</li>\n</ul>\n<h3 id="write-a-promise">Write a Promise<a class="anchor" href="#write-a-promise"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<ul>\n<li>â­<a href="https://promisesaplus.com/">Promises/A+</a>\n<ul>\n<li>ğŸ› ï¸<a href="https://promisesaplus.com/implementations">Conformant Promises/A+ Implementations</a></li>\n<li>ğŸ› ï¸<a href="https://github.com/promises-aplus">Promises/A+ Â· GitHub</a></li>\n</ul>\n</li>\n<li>ğŸš€<a href="https://juejin.cn/post/7274887531271012388#heading-13">æ‰‹å†™ Promiseï¼šå®ç°ç¬¦åˆ Promises/A+è§„èŒƒçš„ Promise - æ˜é‡‘</a></li>\n<li>ğŸš€<a href="https://www.bilibili.com/video/BV1RR4y1p7my/?vd_source=be278a4cfd00a5f72dcf153eaca79333">æ‰‹å†™ Promise æ ¸å¿ƒä»£ç  - JavaScript å‰ç«¯ Web å·¥ç¨‹å¸ˆ_å“”å“©å“”å“©_bilibili</a>\n<ul>\n<li><a href="https://juejin.cn/post/7043758954496655397#heading-14">æ‰‹æŠŠæ‰‹ä¸€è¡Œä¸€è¡Œä»£ç æ•™ä½ â€œæ‰‹å†™ Promiseâ€œï¼Œå®Œç¾é€šè¿‡ Promises/A+ å®˜æ–¹ 872 ä¸ªæµ‹è¯•ç”¨ä¾‹ - æ˜é‡‘</a></li>\n</ul>\n</li>\n<li>[Promise å®ç°åŸç†ï¼ˆé™„æºç ï¼‰](<a href="https://juejin.cn/post/6844903665686282253">https://juejin.cn/post/6844903665686282253</a> <a href="https://juejin.cn/post/6844903665686282253">https://juejin.cn/post/6844903665686282253</a>)</li>\n<li>[100 è¡Œä»£ç å®ç° Promises/A+ è§„èŒƒ](<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqdJ0Xd8zTgtetFdlJL3P1g">https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqdJ0Xd8zTgtetFdlJL3P1g</a> <a href="https://mp.weixin.qq.com/s/qdJ0Xd8zTgtetFdlJL3P1g">https://mp.weixin.qq.com/s/qdJ0Xd8zTgtetFdlJL3P1g</a>)</li>\n<li>[ä¸€èµ·å­¦ä¹ é€ è½®å­ï¼ˆä¸€ï¼‰ï¼šä»é›¶å¼€å§‹å†™ä¸€ä¸ªç¬¦åˆ Promises/A+è§„èŒƒçš„ promise](<a href="https://juejin.cn/post/6844903617619558408#heading-34">https://juejin.cn/post/6844903617619558408#heading-34</a> <a href="https://juejin.cn/post/6844903617619558408#heading-34">https://juejin.cn/post/6844903617619558408#heading-34</a>)</li>\n<li>[BAT å‰ç«¯ç»å…¸é¢è¯•é—®é¢˜ï¼šå²ä¸Šæœ€æœ€æœ€è¯¦ç»†çš„æ‰‹å†™ Promise æ•™ç¨‹](<a href="https://juejin.cn/post/6844903625769091079#heading-9">https://juejin.cn/post/6844903625769091079#heading-9</a> <a href="https://juejin.cn/post/6844903625769091079#heading-9">https://juejin.cn/post/6844903625769091079#heading-9</a>)</li>\n</ul>\n<h2 id="what-is-a-promise">What is a Promise?<a class="anchor" href="#what-is-a-promise"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2>\n<ul>\n<li>A promise is a returned <strong>object</strong> to which you attach callbacks, instead of passing callbacks into a function.</li>\n<li>It represents the eventual completion (or failure) of an asynchronous operation and its resulting value.</li>\n<li>Promise æ˜¯ä¸€ç§å¤„ç†å¼‚æ­¥ä»£ç ï¼ˆè€Œä¸ä¼šé™·å…¥å›è°ƒåœ°ç‹±ï¼‰çš„æ–¹å¼ã€‚</li>\n</ul>\n<h2 id="promise-state--result">Promise State &#x26; Result<a class="anchor" href="#promise-state--result"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2>\n<h4 id="3-ç§çŠ¶æ€-promisestate">3 ç§çŠ¶æ€ (PromiseState)<a class="anchor" href="#3-ç§çŠ¶æ€-promisestate"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<ul>\n<li><strong>pending</strong>: initial state, neither fulfilled nor rejected.</li>\n<li><strong>fulfilled</strong> (resolved): meaning that the operation was completed successfully.</li>\n<li><strong>rejected</strong>: meaning that the operation failed</li>\n<li><img src="https://cdn.jsdelivr.net/gh/jenniferwonder/bimg/programming/z-PromiseState-1.png" alt=""> <img src="https://cdn.jsdelivr.net/gh/jenniferwonder/bimg/programming/z-PromiseState.png" alt=""></li>\n</ul>\n<h4 id="æ‰§è¡Œç‰¹ç‚¹">æ‰§è¡Œç‰¹ç‚¹<a class="anchor" href="#æ‰§è¡Œç‰¹ç‚¹"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<ul>\n<li>Promise åªä»¥<code>ç¬¬ä¸€æ¬¡ä¸ºå‡†</code>ï¼Œç¬¬ä¸€æ¬¡æˆåŠŸå°±<code>æ°¸ä¹…</code>ä¸º<code>fulfilled</code>ï¼Œç¬¬ä¸€æ¬¡å¤±è´¥å°±æ°¸è¿œçŠ¶æ€ä¸º<code>rejected</code></li>\n<li>Promise ä¸­æœ‰ <code>throw</code> çš„è¯ï¼Œå°±ç›¸å½“äºæ‰§è¡Œäº†<code>reject</code></li>\n</ul>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> p1 </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">reject</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#B392F0">\tresolve</span><span style="color:#E1E4E8">(æˆåŠŸ);</span></span>\n<span class="line"><span style="color:#B392F0">\treject</span><span style="color:#E1E4E8">(å¤±è´¥);</span></span>\n<span class="line"><span style="color:#E1E4E8">});</span></span>\n<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(p1, p1);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> p2 </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">reject</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#B392F0">\treject</span><span style="color:#E1E4E8">(å¤±è´¥);</span></span>\n<span class="line"><span style="color:#B392F0">\tresolve</span><span style="color:#E1E4E8">(æˆåŠŸ);</span></span>\n<span class="line"><span style="color:#E1E4E8">});</span></span>\n<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(p2, p2);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> p3 </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">reject</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\tthrow</span><span style="color:#E1E4E8"> æŠ¥é”™;</span></span>\n<span class="line"><span style="color:#E1E4E8">});</span></span>\n<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(p3, p3);</span></span>\n<span class="line"></span></code></pre>\n<h4 id="pending-state-ç‰¹ç‚¹">Pending State ç‰¹ç‚¹<a class="anchor" href="#pending-state-ç‰¹ç‚¹"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<ul>\n<li>Promise é‡Œæ²¡æœ‰æ‰§è¡Œ<code>resolve</code>ã€<code>reject</code>ä»¥åŠ<code>throw</code>çš„è¯ï¼Œè¿™ä¸ª promise çš„çŠ¶æ€ä¹Ÿæ˜¯<code>pending</code></li>\n<li><code>pending</code>çŠ¶æ€ä¸‹çš„ promise ä¸ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°<code>then()</code></li>\n</ul>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> myPromise1 </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {});</span></span>\n<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(myPromise1 :</span><span style="color:#F97583">>></span><span style="color:#E1E4E8"> , myPromise1);</span></span>\n<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> myPromise2 </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">reject</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\tlet</span><span style="color:#E1E4E8"> a </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>\n<span class="line"><span style="color:#F97583">\tfor</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">let</span><span style="color:#E1E4E8"> index </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; index </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 5</span><span style="color:#E1E4E8">; index</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">) {</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\ta</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">;</span></span>\n<span class="line"><span style="color:#E1E4E8">\t}</span></span>\n<span class="line"><span style="color:#E1E4E8">});</span></span>\n<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(myPromise2 :</span><span style="color:#F97583">>></span><span style="color:#E1E4E8"> , myPromise2);</span></span>\n<span class="line"><span style="color:#E1E4E8">myPromise2.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#E1E4E8">\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(myPromise2æ‰§è¡Œäº†then); </span><span style="color:#6A737D">// åœ¨ Promise pending çŠ¶æ€ä¸‹ä¸ä¼šæ‰§è¡Œ</span></span>\n<span class="line"><span style="color:#E1E4E8">});</span></span>\n<span class="line"></span></code></pre>\n<h2 id="create-a-promise">Create a Promise<a class="anchor" href="#create-a-promise"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2>\n<h3 id="new-promise"><code>new Promise()</code><a class="anchor" href="#new-promise"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<h4 id="å‚æ•°è¦æ±‚">å‚æ•°è¦æ±‚<a class="anchor" href="#å‚æ•°è¦æ±‚"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<ul>\n<li>ä½¿ç”¨ <code>new Promise()</code> å¿…é¡»è¾“å…¥ä¸€ä¸ªæ‰§è¡Œå‡½æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™</li>\n</ul>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> myPromise0 </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">();</span></span>\n<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(myPromise0 :</span><span style="color:#F97583">>></span><span style="color:#E1E4E8"> , myPromise0); </span><span style="color:#6A737D">// æŠ¥é”™ï¼šTypeError: Promise resolver undefined</span></span>\n<span class="line"></span></code></pre>\n<h5 id="case">Case<a class="anchor" href="#case"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> makeRequest</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">location</span><span style="color:#E1E4E8">) {</span></span>\n<span class="line"><span style="color:#F97583">\treturn</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">reject</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`Making Request to ${</span><span style="color:#E1E4E8">location</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">);</span></span>\n<span class="line"><span style="color:#F97583">\t\tif</span><span style="color:#E1E4E8"> (location </span><span style="color:#F97583">===</span><span style="color:#E1E4E8"> Google) {</span></span>\n<span class="line"><span style="color:#B392F0">\t\t\tresolve</span><span style="color:#E1E4E8">(Google says Hi);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t} </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#B392F0">\t\t\treject</span><span style="color:#E1E4E8">(We can only talk to Google);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t}</span></span>\n<span class="line"><span style="color:#E1E4E8">\t});</span></span>\n<span class="line"><span style="color:#E1E4E8">}</span></span>\n<span class="line"></span></code></pre>\n<h4 id="-æ‰§è¡Œé¡ºåº">â­ æ‰§è¡Œé¡ºåº<a class="anchor" href="#-æ‰§è¡Œé¡ºåº"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<ul>\n<li>Promise æ„é€ å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œ<code>promise.then</code>Â  ä¸­çš„å‡½æ•°æ˜¯å¼‚æ­¥æ‰§è¡Œçš„</li>\n</ul>\n<h5 id="case-1">Case<a class="anchor" href="#case-1"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> promise</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">reject</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#E1E4E8">\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>\n<span class="line"><span style="color:#B392F0">\tresolve</span><span style="color:#E1E4E8">();</span></span>\n<span class="line"><span style="color:#E1E4E8">\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">);</span></span>\n<span class="line"><span style="color:#E1E4E8">});</span></span>\n<span class="line"><span style="color:#E1E4E8">promise.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#E1E4E8">\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">);</span></span>\n<span class="line"><span style="color:#E1E4E8">});</span></span>\n<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">);</span></span>\n<span class="line"></span></code></pre>\n<h5 id="output">Output<a class="anchor" href="#output"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#B392F0">1</span></span>\n<span class="line"><span style="color:#B392F0">2</span></span>\n<span class="line"><span style="color:#B392F0">4</span></span>\n<span class="line"><span style="color:#B392F0">3</span></span>\n<span class="line"></span></code></pre>\n<h3 id="promiseresolve"><code>Promise.resolve()</code><a class="anchor" href="#promiseresolve"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<p>å°†ç°æœ‰å¯¹è±¡è½¬ä¸º Promise å¯¹è±¡</p>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#79B8FF">Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">resolve</span><span style="color:#E1E4E8">(foo);</span></span>\n<span class="line"><span style="color:#6A737D">// ç­‰ä»·äº</span></span>\n<span class="line"><span style="color:#F97583">new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> resolve</span><span style="color:#E1E4E8">(foo));</span></span>\n<span class="line"></span></code></pre>\n<h4 id="å‚æ•°çš„å››ç§æƒ…å†µ">å‚æ•°çš„å››ç§æƒ…å†µ<a class="anchor" href="#å‚æ•°çš„å››ç§æƒ…å†µ"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<ol>\n<li>å¦‚æœå‚æ•°æ˜¯ <code>Promise</code> å®ä¾‹\n<ul>\n<li>é‚£ä¹ˆ <code>Promise.resolve()</code> å°†ä¸åšä»»ä½•ä¿®æ”¹ã€åŸå°ä¸åŠ¨åœ°è¿”å›è¿™ä¸ªå®ä¾‹ã€‚</li>\n</ul>\n</li>\n<li>å‚æ•°æ˜¯ä¸€ä¸ª thenable (å…·æœ‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡) å¯¹è±¡\n<ul>\n<li>ä¼šå°†è¿™ä¸ªå¯¹è±¡è½¬ä¸º <code>Promise</code> å¯¹è±¡ï¼Œç„¶åå°±ç«‹å³æ‰§è¡Œ thenable å¯¹è±¡çš„ <code>then</code>æ–¹æ³•</li>\n</ul>\n</li>\n<li>å‚æ•°æ˜¯ä¸€ä¸ªåŸå§‹å€¼ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªä¸å…·æœ‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡\n<ul>\n<li>åˆ™<code>Promise.resolve</code>æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ Â <code>Promise</code>Â  å¯¹è±¡ï¼ŒçŠ¶æ€ä¸º<code>resolved</code></li>\n</ul>\n</li>\n<li><code>Promise.resolve()</code>æ–¹æ³•å…è®¸è°ƒç”¨æ—¶ä¸å¸¦å‚æ•°\n<ul>\n<li>ç›´æ¥è¿”å›ä¸€ä¸ª <code>resolved</code>çŠ¶æ€çš„ <code>Promise</code> å¯¹è±¡ã€‚</li>\n</ul>\n</li>\n</ol>\n<h4 id="example">Example<a class="anchor" href="#example"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> tick</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Date.</span><span style="color:#B392F0">now</span><span style="color:#E1E4E8">();</span></span>\n<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> log</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">v</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`${</span><span style="color:#E1E4E8">v</span><span style="color:#9ECBFF">} </span><span style="color:#79B8FF">\\n</span><span style="color:#9ECBFF"> Elapsed: ${</span><span style="color:#E1E4E8">Date</span><span style="color:#9ECBFF">.</span><span style="color:#B392F0">now</span><span style="color:#9ECBFF">() </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> tick</span><span style="color:#9ECBFF">}ms`</span><span style="color:#E1E4E8">);</span></span>\n<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> codeBlocker</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#6A737D">\t// Blocking</span></span>\n<span class="line"><span style="color:#6A737D">\t// let i = 0;</span></span>\n<span class="line"><span style="color:#6A737D">\t// while(i &#x3C; 1000000000) { i++;}</span></span>\n<span class="line"><span style="color:#6A737D">\t// return \'ğŸ· billion loops done\';</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#6A737D">\t// Async blocking</span></span>\n<span class="line"><span style="color:#6A737D">\t// return new Promise((resolve, reject) => {</span></span>\n<span class="line"><span style="color:#6A737D">\t// let i = 0;</span></span>\n<span class="line"><span style="color:#6A737D">\t// while(i &#x3C; 1000000000) { i++;}</span></span>\n<span class="line"><span style="color:#6A737D">\t// resolve(\'ğŸ· billion loops done\');</span></span>\n<span class="line"><span style="color:#6A737D">\t// })</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#6A737D">\t// Non-blocking</span></span>\n<span class="line"><span style="color:#F97583">\treturn</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">resolve</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">v</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\tlet</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>\n<span class="line"><span style="color:#F97583">\t\twhile</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 1000000000</span><span style="color:#E1E4E8">) {</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t\ti</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">;</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t}</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#E1E4E8"> ğŸ· billion loops done;</span></span>\n<span class="line"><span style="color:#E1E4E8">\t});</span></span>\n<span class="line"><span style="color:#E1E4E8">};</span></span>\n<span class="line"><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(ğŸ¥ª Synchronous </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>\n<span class="line"><span style="color:#B392F0">codeBlocker</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(log);</span></span>\n<span class="line"><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(ğŸ¥ª Synchronous </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">);</span></span>\n<span class="line"></span></code></pre>\n<h3 id="promisereject"><code>Promise.reject()</code><a class="anchor" href="#promisereject"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<ul>\n<li><code>Promise.reject()</code>æ–¹æ³•çš„å‚æ•°ï¼Œä¼šåŸå°ä¸åŠ¨åœ°ä½œä¸º<code>reject</code>çš„ç†ç”±ï¼Œå˜æˆåç»­æ–¹æ³•çš„å‚æ•°</li>\n</ul>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> thenable</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#B392F0">\tthen</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">reject</span><span style="color:#E1E4E8">) {</span></span>\n<span class="line"><span style="color:#B392F0">\t\treject</span><span style="color:#E1E4E8">(å‡ºé”™äº†);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t},</span></span>\n<span class="line"><span style="color:#E1E4E8">};</span></span>\n<span class="line"><span style="color:#79B8FF">Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">reject</span><span style="color:#E1E4E8">(thenable).</span><span style="color:#B392F0">catch</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#E1E4E8">\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(e </span><span style="color:#F97583">===</span><span style="color:#E1E4E8"> thenable);</span></span>\n<span class="line"><span style="color:#E1E4E8">});</span></span>\n<span class="line"><span style="color:#6A737D">// true</span></span>\n<span class="line"></span></code></pre>\n<h2 id="consume-promise">Consume Promise<a class="anchor" href="#consume-promise"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2>\n<h3 id="promiseprototypethen"><code>Promise.prototype.then()</code><a class="anchor" href="#promiseprototypethen"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<p>æ¥æ”¶ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå‡ä¸ºå¯é€‰å‚æ•°</p>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#79B8FF">Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">resolve</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">onFulfilled</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">=></span><span style="color:#E1E4E8">{}, </span><span style="color:#B392F0">onReject</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{})</span></span>\n<span class="line"></span></code></pre>\n<h3 id="promiseprototypecatch"><code>Promise.prototype.catch()</code><a class="anchor" href="#promiseprototypecatch"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<h4 id="é”™è¯¯æ•è·æ¡ä»¶">é”™è¯¯æ•è·æ¡ä»¶<a class="anchor" href="#é”™è¯¯æ•è·æ¡ä»¶"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<p>âŒ åœ¨<code>then</code>æˆ–<code>catch</code>ä¸­ <code>return</code> ä¸€ä¸ª <code>new Error</code> å¯¹è±¡ä¸ä¼šè¢«æ•è·ï¼š\n<code>return new Error(Error!)</code>\nâœ… å¿…é¡»ä½¿ç”¨ä»¥ä¸‹ä»»ä¸€ä¸€ç§è¯­æ³•ï¼š</p>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">return</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">reject</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Error</span><span style="color:#E1E4E8">(error</span><span style="color:#F97583">!!!</span><span style="color:#E1E4E8">));</span></span>\n<span class="line"><span style="color:#F97583">throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Error</span><span style="color:#E1E4E8">(error</span><span style="color:#F97583">!!!</span><span style="color:#E1E4E8">);</span></span>\n<span class="line"></span></code></pre>\n<h4 id="çº§è”é”™è¯¯">çº§è”é”™è¯¯<a class="anchor" href="#çº§è”é”™è¯¯"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<ul>\n<li>å¦‚æœåœ¨ Â <code>catch()</code>Â  å†…éƒ¨å¼•å‘é”™è¯¯ï¼Œåˆ™å¯ä»¥é™„åŠ ç¬¬äºŒä¸ª Â <code>catch()</code>æ¥å¤„ç†ï¼Œä¾æ­¤ç±»æ¨</li>\n</ul>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">reject</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\tthrow</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Error</span><span style="color:#E1E4E8">(é”™è¯¯);</span></span>\n<span class="line"><span style="color:#E1E4E8">})</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">catch</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">err</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\tthrow</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Error</span><span style="color:#E1E4E8">(é”™è¯¯);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t})</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">catch</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">err</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\tconsole.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(err);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t});</span></span>\n<span class="line"></span></code></pre>\n<h3 id="promiseprototypefinally"><code>Promise.prototype.finally()</code><a class="anchor" href="#promiseprototypefinally"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<ul>\n<li>ç”¨äºæŒ‡å®šä¸ç®¡ Promise å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚è¯¥æ–¹æ³•æ˜¯ ES2018 å¼•å…¥æ ‡å‡†çš„\n<ul>\n<li>é¿å…äº†åŒæ ·çš„è¯­å¥éœ€è¦åœ¨<code>then()</code>å’Œ<code>catch()</code>ä¸­å„å†™ä¸€æ¬¡çš„æƒ…å†µã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id="example-consume-promise-">Example (Consume Promise )<a class="anchor" href="#example-consume-promise-"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<h4 id="example-promise-chain">Example (Promise chain)<a class="anchor" href="#example-promise-chain"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D">// import fetch from node-fetch;</span></span>\n<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> promise</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> fetch</span><span style="color:#E1E4E8">(https:</span><span style="color:#6A737D">//jsonplaceholder.typicode.com/todos/1);</span></span>\n<span class="line"><span style="color:#E1E4E8">promise</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">res</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> res.</span><span style="color:#B392F0">json</span><span style="color:#E1E4E8">())</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">todo</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\tthrow</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Error</span><span style="color:#E1E4E8">(uh oh);</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#E1E4E8"> todo;</span></span>\n<span class="line"><span style="color:#E1E4E8">\t})</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">todo</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(ğŸ˜›, todo.title)) </span><span style="color:#6A737D">// This line will be bypasses</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">catch</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">err</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(ğŸ˜­, err));</span></span>\n<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(ğŸ¥ª Synchronous);</span></span>\n<span class="line"></span></code></pre>\n<h4 id="example-ice-cream-shop">Example (Ice-cream Shop)<a class="anchor" href="#example-ice-cream-shop"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<ul>\n<li><a href="https://www.bilibili.com/video/BV1g44y1z7N3/?spm_id_from=333.788.recommend_more_video.4&#x26;vd_source=be278a4cfd00a5f72dcf153eaca79333">[è‹±å­—] JavaScript å¼‚æ­¥ç¼–ç¨‹ï¼ˆAsync/Awaitã€Promiseã€Callbackï¼‰FreeCodeCamp</a></li>\n<li><a href="https://www.freecodecamp.org/news/javascript-async-await-tutorial-learn-callbacks-promises-async-await-by-making-icecream/">FreeCodeCamp-Blog</a></li>\n</ul>\n<h5 id="relationship-between-time-and-work">Relationship between time and work<a class="anchor" href="#relationship-between-time-and-work"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> is_shop_open </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>\n<span class="line"><span style="color:#F97583">let</span><span style="color:#B392F0"> order</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">time</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">work</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\treturn</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">reject</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\tif</span><span style="color:#E1E4E8"> (is_shop_open) {</span></span>\n<span class="line"><span style="color:#B392F0">\t\t\tsetTimeout</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#6A737D">\t\t\t\t// work is ğŸ‘‡ getting done here</span></span>\n<span class="line"><span style="color:#B392F0">\t\t\t\tresolve</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">work</span><span style="color:#E1E4E8">());</span></span>\n<span class="line"><span style="color:#6A737D">\t\t\t\t// Setting ğŸ‘‡ time here for 1 work</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t\t}, time);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t} </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#B392F0">\t\t\treject</span><span style="color:#E1E4E8">(console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(Our shop is closed));</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t}</span></span>\n<span class="line"><span style="color:#E1E4E8">\t});</span></span>\n<span class="line"><span style="color:#E1E4E8">};</span></span>\n<span class="line"></span></code></pre>\n<h5 id="promise-chaining">Promise chaining<a class="anchor" href="#promise-chaining"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D">// step 1</span></span>\n<span class="line"><span style="color:#B392F0">order</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2000</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`${</span><span style="color:#E1E4E8">stocks</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">Fruits</span><span style="color:#9ECBFF">[</span><span style="color:#79B8FF">0</span><span style="color:#9ECBFF">]</span><span style="color:#9ECBFF">} was selected`</span><span style="color:#E1E4E8">))</span></span>\n<span class="line"><span style="color:#6A737D">\t// step 2</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#B392F0"> order</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0000</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(production has started)))</span></span>\n<span class="line"><span style="color:#6A737D">\t// step 3</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#B392F0"> order</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2000</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(Fruit has been chopped));</span></span>\n<span class="line"><span style="color:#E1E4E8">\t})</span></span>\n<span class="line"><span style="color:#6A737D">\t// step 4</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#B392F0"> order</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`${</span><span style="color:#E1E4E8">stocks</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">liquid</span><span style="color:#9ECBFF">[</span><span style="color:#79B8FF">0</span><span style="color:#9ECBFF">]</span><span style="color:#9ECBFF">} and ${</span><span style="color:#E1E4E8">stocks</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">liquid</span><span style="color:#9ECBFF">[</span><span style="color:#79B8FF">1</span><span style="color:#9ECBFF">]</span><span style="color:#9ECBFF">} added`</span><span style="color:#E1E4E8">)</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t})</span></span>\n<span class="line"><span style="color:#6A737D">\t// step 5</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#B392F0"> order</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(start the machine));</span></span>\n<span class="line"><span style="color:#E1E4E8">\t})</span></span>\n<span class="line"><span style="color:#6A737D">\t// step 6</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#B392F0"> order</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2000</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`ice cream placed on ${</span><span style="color:#E1E4E8">stocks</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">holder</span><span style="color:#9ECBFF">[</span><span style="color:#79B8FF">1</span><span style="color:#9ECBFF">]</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">)</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t})</span></span>\n<span class="line"><span style="color:#6A737D">\t// step 7</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#B392F0"> order</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">3000</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`${</span><span style="color:#E1E4E8">stocks</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">toppings</span><span style="color:#9ECBFF">[</span><span style="color:#79B8FF">0</span><span style="color:#9ECBFF">]</span><span style="color:#9ECBFF">} as toppings`</span><span style="color:#E1E4E8">));</span></span>\n<span class="line"><span style="color:#E1E4E8">\t})</span></span>\n<span class="line"><span style="color:#6A737D">\t// Step 8</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#B392F0"> order</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2000</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(Serve Ice Cream));</span></span>\n<span class="line"><span style="color:#E1E4E8">\t});</span></span>\n<span class="line"></span></code></pre>\n<h5 id="error-handling">Error handling<a class="anchor" href="#error-handling"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> is_shop_open </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>\n<span class="line"><span style="color:#6A737D">// Add Error handling at the end of the Promise chain</span></span>\n<span class="line"><span style="color:#E1E4E8">.</span><span style="color:#B392F0">catch</span><span style="color:#E1E4E8">(()</span><span style="color:#F97583">=></span><span style="color:#E1E4E8">{</span></span>\n<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(Customer left)</span></span>\n<span class="line"><span style="color:#E1E4E8">})</span></span>\n<span class="line"><span style="color:#6A737D">// Output:</span></span>\n<span class="line"><span style="color:#6A737D">// Our shop is closed -- from reject</span></span>\n<span class="line"><span style="color:#6A737D">// Customer left -- from catch</span></span>\n<span class="line"></span></code></pre>\n<h5 id="thefinallyhandler">TheÂ <code>.finally</code>Â handler<a class="anchor" href="#thefinallyhandler"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>\n<p>TheÂ <code>finally</code>Â handler which works regardless of whether our promise was resolved or rejected.</p>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Whether we serve no customers or 100 customers, our shop will close at the end of the day. Optional - Add `finally` at the very bottom of the chain</span></span>\n<span class="line"><span style="color:#E1E4E8">.</span><span style="color:#B392F0">finally</span><span style="color:#E1E4E8">(()</span><span style="color:#F97583">=></span><span style="color:#E1E4E8">{</span></span>\n<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(end </span><span style="color:#F97583">of</span><span style="color:#E1E4E8"> day)</span></span>\n<span class="line"><span style="color:#E1E4E8">})</span></span>\n<span class="line"></span></code></pre>\n<h4 id="avoid-mistakes">Avoid Mistakes<a class="anchor" href="#avoid-mistakes"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#B392F0">doSomething</span><span style="color:#E1E4E8">()</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">function</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">result</span><span style="color:#E1E4E8">) {</span></span>\n<span class="line"><span style="color:#6A737D">\t\t// If using a full function expression: return the promise</span></span>\n<span class="line"><span style="color:#F97583">\t\treturn</span><span style="color:#B392F0"> doSomethingElse</span><span style="color:#E1E4E8">(result);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t})</span></span>\n<span class="line"><span style="color:#6A737D">\t// If using arrow functions: omit the braces and implicitly return the result</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">newResult</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> doThirdThing</span><span style="color:#E1E4E8">(newResult))</span></span>\n<span class="line"><span style="color:#6A737D">\t// Even if the previous chained promise returns a result, the next one</span></span>\n<span class="line"><span style="color:#6A737D">\t// doesn\'t necessarily have to use it. You can pass a handler that doesn\'t</span></span>\n<span class="line"><span style="color:#6A737D">\t// consume any result.</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#6A737D">/* result ignored */</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> doFourthThing</span><span style="color:#E1E4E8">())</span></span>\n<span class="line"><span style="color:#6A737D">\t// Always end the promise chain with a catch handler to avoid any</span></span>\n<span class="line"><span style="color:#6A737D">\t// unhandled rejections!</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">catch</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">error</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(error));</span></span>\n<span class="line"></span></code></pre>\n<h2 id="more-promise-method-æ›´å¤š-promise-å¯¹è±¡æ–¹æ³•">More Promise Method (æ›´å¤š Promise å¯¹è±¡æ–¹æ³•)<a class="anchor" href="#more-promise-method-æ›´å¤š-promise-å¯¹è±¡æ–¹æ³•"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2>\n<h3 id="promiseall"><code>Promise.all()</code><a class="anchor" href="#promiseall"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<ul>\n<li>å‘èµ·å¤šä¸ªå¹¶å‘è¯·æ±‚ï¼Œç„¶ååœ¨æ‰€æœ‰ promise éƒ½è¢«è§£å†³åæ‰§è¡Œä¸€äº›æ“ä½œ</li>\n<li>é€‚åˆå½¼æ­¤ç›¸äº’ä¾èµ–æˆ–è€…åœ¨å…¶ä¸­ä»»ä½•ä¸€ä¸ª<code>reject</code>æ—¶ç«‹å³ç»“æŸ</li>\n</ul>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> promise1</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">resolve</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">);</span></span>\n<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> promise2</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 42</span><span style="color:#E1E4E8">;</span></span>\n<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> promise3</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">reject</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#B392F0">\tsetTimeout</span><span style="color:#E1E4E8">(resolve, </span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">, foo);</span></span>\n<span class="line"><span style="color:#E1E4E8">});</span></span>\n<span class="line"><span style="color:#79B8FF">Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">all</span><span style="color:#E1E4E8">([promise1, promise2, promise3]).</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">values</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#E1E4E8">\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(values);</span></span>\n<span class="line"><span style="color:#E1E4E8">});</span></span>\n<span class="line"><span style="color:#6A737D">// expected output: Array [3, 42, foo]</span></span>\n<span class="line"></span></code></pre>\n<h3 id="promiserace"><code>Promise.race()</code><a class="anchor" href="#promiserace"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<ul>\n<li>ä¼ å…¥å¤šä¸ª promise å®ä¾‹ï¼Œè°è·‘çš„å¿«ï¼Œå°±ä»¥è°çš„ç»“æœæ‰§è¡Œå›è°ƒ</li>\n</ul>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> first</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">reject</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#B392F0">\tsetTimeout</span><span style="color:#E1E4E8">(resolve, </span><span style="color:#79B8FF">500</span><span style="color:#E1E4E8">, ç¬¬ä¸€ä¸ª);</span></span>\n<span class="line"><span style="color:#E1E4E8">});</span></span>\n<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> second</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">reject</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#B392F0">\tsetTimeout</span><span style="color:#E1E4E8">(resolve, </span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">, ç¬¬äºŒä¸ª);</span></span>\n<span class="line"><span style="color:#E1E4E8">});</span></span>\n<span class="line"><span style="color:#79B8FF">Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">race</span><span style="color:#E1E4E8">([first, second]).</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">result</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#E1E4E8">\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(result); </span><span style="color:#6A737D">// ç¬¬äºŒä¸ª</span></span>\n<span class="line"><span style="color:#E1E4E8">});</span></span>\n<span class="line"></span></code></pre>\n<h4 id="use-case">Use Case<a class="anchor" href="#use-case"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<p>1ã€æŠŠå¼‚æ­¥æ“ä½œå’Œå®šæ—¶å™¨æ”¾åˆ°ä¸€èµ·ï¼Œå¦‚æœå®šæ—¶å™¨å…ˆè§¦å‘ï¼Œè®¤ä¸ºè¶…æ—¶ï¼Œå‘ŠçŸ¥ç”¨æˆ·</p>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> timeOut</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">time</span><span style="color:#E1E4E8">) {</span></span>\n<span class="line"><span style="color:#F97583">\tlet</span><span style="color:#E1E4E8"> result </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">reject</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#B392F0">\t\tsetTimeout</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#B392F0">\t\t\tresolve</span><span style="color:#E1E4E8">(è¯·æ±‚è¶…æ—¶);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t}, time); </span><span style="color:#6A737D">// ä¸ºäº†éªŒè¯æ–¹æ³•ï¼Œå¯ä»¥æŠŠæ—¶é—´è®¾å°ç‚¹</span></span>\n<span class="line"><span style="color:#E1E4E8">\t});</span></span>\n<span class="line"><span style="color:#F97583">\treturn</span><span style="color:#E1E4E8"> result;</span></span>\n<span class="line"><span style="color:#E1E4E8">}</span></span>\n<span class="line"><span style="color:#79B8FF">Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">race</span><span style="color:#E1E4E8">([</span><span style="color:#B392F0">timeOut</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">200</span><span style="color:#E1E4E8">), </span><span style="color:#B392F0">fetch</span><span style="color:#E1E4E8">(https:</span><span style="color:#6A737D">//api.github.com/users/ruanyf)]).then(</span></span>\n<span class="line"><span style="color:#E1E4E8">\t(</span><span style="color:#FFAB70">res</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(res);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t}</span></span>\n<span class="line"><span style="color:#E1E4E8">);</span></span>\n<span class="line"></span></code></pre>\n<p>2ã€å¦‚æœå›¾ç‰‡ç­‰èµ„æºæœ‰å¤šä¸ªå­˜æ”¾è·¯å¾„ï¼Œä½†æ˜¯ä¸ç¡®å®šå“ªä¸ªè·¯å¾„çš„èµ„æºæ›´å¿«ï¼Œå¯ä»¥ç”¨è¯¥æ–¹æ³•åŒæ—¶è¯·æ±‚å¤šä¸ªè·¯å¾„ï¼Œå“ªä¸ªè·¯å¾„çš„èµ„æºæœ€å…ˆæ‹¿åˆ°ï¼Œä½¿ç”¨å“ªä¸ªèµ„æº</p>\n<p>3ã€å¦‚æœæŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è·å¾—ç»“æœï¼Œå°±å°† Promise çš„çŠ¶æ€å˜ä¸º <code>reject</code>ï¼Œå¦åˆ™å˜ä¸º<code>resolve</code></p>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> p</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">race</span><span style="color:#E1E4E8">([</span></span>\n<span class="line"><span style="color:#B392F0">\tfetch</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">resource</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">that</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">may</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">take</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">a</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">while),</span></span>\n<span class="line"><span style="color:#F97583">\tnew</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">function</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">resolve</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">reject</span><span style="color:#E1E4E8">) {</span></span>\n<span class="line"><span style="color:#B392F0">\t\tsetTimeout</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#B392F0"> reject</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Error</span><span style="color:#E1E4E8">(request timeout)), </span><span style="color:#79B8FF">5000</span><span style="color:#E1E4E8">);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t}),</span></span>\n<span class="line"><span style="color:#E1E4E8">]);</span></span>\n<span class="line"><span style="color:#E1E4E8">p.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(console.log).</span><span style="color:#B392F0">catch</span><span style="color:#E1E4E8">(console.error);</span></span>\n<span class="line"></span></code></pre>\n<h3 id="promiseallsettled-es2020"><code>Promise.allSettled()</code> (ES2020)<a class="anchor" href="#promiseallsettled-es2020"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<ul>\n<li>ç”± ES2020 å¼•å…¥</li>\n<li>åŠŸèƒ½\n<ul>\n<li>æœ‰å¤šä¸ªå½¼æ­¤ä¸ä¾èµ–çš„å¼‚æ­¥ä»»åŠ¡æˆåŠŸå®Œæˆæ—¶ï¼Œæˆ–è€…æ‚¨æ€»æ˜¯æƒ³çŸ¥é“æ¯ä¸ª promise çš„ç»“æœæ—¶ï¼Œé€šå¸¸ä½¿ç”¨</li>\n<li><code>Promise.all()</code>æ— æ³•ç¡®å®šæ‰€æœ‰è¯·æ±‚éƒ½ç»“æŸã€‚æƒ³è¦è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œå†™èµ·æ¥å¾ˆéº»çƒ¦ï¼Œæœ‰äº†<code>Promise.allSettled()</code>ï¼Œè¿™å°±å¾ˆå®¹æ˜“äº†</li>\n</ul>\n</li>\n</ul>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> urls</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span></span>\n<span class="line"><span style="color:#6A737D">\t/* ... */</span></span>\n<span class="line"><span style="color:#E1E4E8">];</span></span>\n<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> requests</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> urls.</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">x</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> fetch</span><span style="color:#E1E4E8">(x));</span></span>\n<span class="line"><span style="color:#F97583">try</span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\tawait</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">all</span><span style="color:#E1E4E8">(requests);</span></span>\n<span class="line"><span style="color:#E1E4E8">\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(æ‰€æœ‰è¯·æ±‚éƒ½æˆåŠŸã€‚);</span></span>\n<span class="line"><span style="color:#E1E4E8">} </span><span style="color:#F97583">catch</span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#E1E4E8">\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(è‡³å°‘ä¸€ä¸ªè¯·æ±‚å¤±è´¥ï¼Œå…¶ä»–è¯·æ±‚å¯èƒ½è¿˜æ²¡ç»“æŸã€‚);</span></span>\n<span class="line"><span style="color:#E1E4E8">}</span></span>\n<span class="line"></span></code></pre>\n<h4 id="è¿”å›å€¼">è¿”å›å€¼<a class="anchor" href="#è¿”å›å€¼"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>\n<ul>\n<li>è¿”å›ä¸€ä¸ªåœ¨æ‰€æœ‰ç»™å®šçš„ promise éƒ½å·²ç»<code>fulfilled</code>æˆ–<code>rejected</code>åçš„ promiseï¼Œå¹¶å¸¦æœ‰ä¸€ä¸ª<strong>å¯¹è±¡æ•°ç»„</strong>ï¼Œæ¯ä¸ªå¯¹è±¡è¡¨ç¤ºå¯¹åº”çš„ promise ç»“æœ\n<ul>\n<li><img src="https://cdn.jsdelivr.net/gh/jenniferwonder/bimg/programming/z-Promise.allSettled.png" alt=""></li>\n</ul>\n</li>\n<li>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰<code>status</code>å±æ€§ï¼Œè¯¥å±æ€§çš„å€¼åªå¯èƒ½æ˜¯å­—ç¬¦ä¸²<code>fulfilled</code>æˆ–å­—ç¬¦ä¸²<code>rejected</code>ã€‚\n<ul>\n<li><code>fulfilled</code>æ—¶ï¼Œå¯¹è±¡æœ‰<code>value</code>å±æ€§ï¼Œ</li>\n<li><code>rejected</code>æ—¶æœ‰<code>reason</code>å±æ€§ï¼Œå¯¹åº”ä¸¤ç§çŠ¶æ€çš„è¿”å›å€¼ã€‚</li>\n</ul>\n</li>\n</ul>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> promises</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#B392F0">fetch</span><span style="color:#E1E4E8">(index.html), </span><span style="color:#B392F0">fetch</span><span style="color:#E1E4E8">(https:</span><span style="color:#6A737D">//does-not-exist/)];</span></span>\n<span class="line"><span style="color:#E1E4E8">const results </span><span style="color:#F97583">=</span><span style="color:#F97583"> await</span><span style="color:#79B8FF"> Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">allSettled</span><span style="color:#E1E4E8">(promises);</span></span>\n<span class="line"><span style="color:#6A737D">// è¿‡æ»¤å‡ºæˆåŠŸçš„è¯·æ±‚</span></span>\n<span class="line"><span style="color:#E1E4E8">const successfulPromises </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> results.</span><span style="color:#B392F0">filter</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">p</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> p.status </span><span style="color:#F97583">===</span><span style="color:#E1E4E8"> fulfilled);</span></span>\n<span class="line"><span style="color:#6A737D">// è¿‡æ»¤å‡ºå¤±è´¥çš„è¯·æ±‚ï¼Œå¹¶è¾“å‡ºåŸå› </span></span>\n<span class="line"><span style="color:#E1E4E8">const errors </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> results</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">filter</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">p</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> p.status </span><span style="color:#F97583">===</span><span style="color:#E1E4E8"> rejected)</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">p</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> p.reason);</span></span>\n<span class="line"></span></code></pre>\n<h3 id="promiseany-es2020"><code>Promise.any()</code> (ES2020)<a class="anchor" href="#promiseany-es2020"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>\n<ul>\n<li>è¾“å…¥\n<ul>\n<li>ä¸€ä¸ª Promise æ•°ç»„</li>\n</ul>\n</li>\n<li>è¿”å›å€¼\n<ul>\n<li>ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡\n<ul>\n<li>è¯¥ Promise å¯¹è±¡åœ¨ä¼ å…¥çš„ Promise æ•°ç»„ä¸­çš„ä»»ä½•ä¸€ä¸ª Promise è§£å†³æ—¶å°±ä¼šè¢«è§£å†³</li>\n<li>è‹¥æ‰€æœ‰çš„ Promise éƒ½è¢«æ‹’ç»ï¼Œåˆ™è¿”å›çš„ Promise ä¼šè¢«æ‹’ç»ï¼Œå¹¶ä¸”å®ƒçš„æ‹’å› æ˜¯ä¸€ä¸ª <code>AggregateError</code> å¯¹è±¡å®ä¾‹ï¼ŒåŒ…å«äº†æ‰€æœ‰è¢«æ‹’ç»çš„ Promise çš„åŸå›  (å¯é€šè¿‡ <code>.errors</code> å±æ€§è¯»å–)</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>è¿”å›å€¼å¤„ç†</li>\n</ul>\n<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#79B8FF">Promise</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">any</span><span style="color:#E1E4E8">([p10, p11])</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">res</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(res))</span></span>\n<span class="line"><span style="color:#E1E4E8">\t.</span><span style="color:#B392F0">catch</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">err</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#F97583">\t\tif</span><span style="color:#E1E4E8"> (err </span><span style="color:#F97583">instanceof</span><span style="color:#B392F0"> AggregateError</span><span style="color:#E1E4E8">) {</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t\tconsole.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(AggregateError occurred:);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t\tconsole.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(err.errors);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t\terr.errors.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">err</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">index</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t\t\tconsole.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`Error ${</span><span style="color:#E1E4E8">index</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> 1</span><span style="color:#9ECBFF">}:`</span><span style="color:#E1E4E8">, err);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t\t});</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t} </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t\tconsole.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(Other error occurred:, err);</span></span>\n<span class="line"><span style="color:#E1E4E8">\t\t}</span></span>\n<span class="line"><span style="color:#E1E4E8">\t});</span></span>\n<span class="line"></span></code></pre>',frontmatter={type:"D",title:"Promise",DateStarted:"2022-12-09T00:00:00.000Z",DateModified:"2024-04-19T00:00:00.000Z",status:null,topic:["Async"],tags:["JavaScript"],category:"Programming",draft:!0,minutes:11,words:2222},file="E:/SynologyDrive/Codespace/blog-site/mynote/my-fuwari-blog/src/content/posts/js/data-fetching/promise.md",url=void 0;function rawContent(){return"\n# Promise\n\n## Reference\n\n- â­[é€šä¿—æ˜“æ‡‚çš„ Promise çŸ¥è¯†ç‚¹æ€»ç»“ï¼Œæ£€éªŒä¸€ä¸‹ä½ æ˜¯å¦çœŸçš„å®Œå…¨æŒæ¡äº† Promiseï¼Ÿ - æ˜é‡‘](https://juejin.cn/post/7020335414980378655)\n  - [Promise - JavaScript | MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)\n  - [Using Promises - JavaScript | MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises)\n- [ä½ å¥½ï¼ŒJavaScript å¼‚æ­¥ç¼–ç¨‹---- ç†è§£ JavaScript å¼‚æ­¥çš„ç¾å¦™](https://juejin.cn/post/6844903648162480142 https://juejin.cn/post/6844903648162480142)\n- [Promise ä¸ä¼šï¼Ÿï¼Ÿçœ‹è¿™é‡Œï¼ï¼ï¼å²ä¸Šæœ€é€šä¿—æ˜“æ‡‚çš„ Promiseï¼ï¼ï¼](https://juejin.cn/post/6844903607968481287 https://juejin.cn/post/6844903607968481287)\n- [å½“ async/await é‡ä¸Š forEach](https://link.juejin.cn?target=https%3A%2F%2Fobjcer.com%2F2017%2F10%2F12%2Fasync-await-with-forEach%2F https://objcer.com/2017/10/12/async-await-with-forEach/)\n- [Promise å¿…çŸ¥å¿…ä¼šï¼ˆåé“é¢˜ï¼‰](https://juejin.cn/post/6844903509934997511 https://juejin.cn/post/6844903509934997511)\n\n### Write a Promise\n\n- â­[Promises/A+](https://promisesaplus.com/)\n  - ğŸ› ï¸[Conformant Promises/A+ Implementations](https://promisesaplus.com/implementations)\n  - ğŸ› ï¸[Promises/A+ Â· GitHub](https://github.com/promises-aplus)\n- ğŸš€[æ‰‹å†™ Promiseï¼šå®ç°ç¬¦åˆ Promises/A+è§„èŒƒçš„ Promise - æ˜é‡‘](https://juejin.cn/post/7274887531271012388#heading-13)\n- ğŸš€[æ‰‹å†™ Promise æ ¸å¿ƒä»£ç  - JavaScript å‰ç«¯ Web å·¥ç¨‹å¸ˆ\\_å“”å“©å“”å“©\\_bilibili](https://www.bilibili.com/video/BV1RR4y1p7my/?vd_source=be278a4cfd00a5f72dcf153eaca79333)\n  - [æ‰‹æŠŠæ‰‹ä¸€è¡Œä¸€è¡Œä»£ç æ•™ä½ â€œæ‰‹å†™ Promiseâ€œï¼Œå®Œç¾é€šè¿‡ Promises/A+ å®˜æ–¹ 872 ä¸ªæµ‹è¯•ç”¨ä¾‹ - æ˜é‡‘](https://juejin.cn/post/7043758954496655397#heading-14)\n- [Promise å®ç°åŸç†ï¼ˆé™„æºç ï¼‰](https://juejin.cn/post/6844903665686282253 https://juejin.cn/post/6844903665686282253)\n- [100 è¡Œä»£ç å®ç° Promises/A+ è§„èŒƒ](https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqdJ0Xd8zTgtetFdlJL3P1g https://mp.weixin.qq.com/s/qdJ0Xd8zTgtetFdlJL3P1g)\n- [ä¸€èµ·å­¦ä¹ é€ è½®å­ï¼ˆä¸€ï¼‰ï¼šä»é›¶å¼€å§‹å†™ä¸€ä¸ªç¬¦åˆ Promises/A+è§„èŒƒçš„ promise](https://juejin.cn/post/6844903617619558408#heading-34 https://juejin.cn/post/6844903617619558408#heading-34)\n- [BAT å‰ç«¯ç»å…¸é¢è¯•é—®é¢˜ï¼šå²ä¸Šæœ€æœ€æœ€è¯¦ç»†çš„æ‰‹å†™ Promise æ•™ç¨‹](https://juejin.cn/post/6844903625769091079#heading-9 https://juejin.cn/post/6844903625769091079#heading-9)\n\n## What is a Promise?\n\n- A promise is a returned **object** to which you attach callbacks, instead of passing callbacks into a function.\n- It represents the eventual completion (or failure) of an asynchronous operation and its resulting value.\n- Promise æ˜¯ä¸€ç§å¤„ç†å¼‚æ­¥ä»£ç ï¼ˆè€Œä¸ä¼šé™·å…¥å›è°ƒåœ°ç‹±ï¼‰çš„æ–¹å¼ã€‚\n\n## Promise State & Result\n\n#### 3 ç§çŠ¶æ€ (PromiseState)\n\n- **pending**: initial state, neither fulfilled nor rejected.\n- **fulfilled** (resolved): meaning that the operation was completed successfully.\n- **rejected**: meaning that the operation failed\n- ![](https://cdn.jsdelivr.net/gh/jenniferwonder/bimg/programming/z-PromiseState-1.png) ![](https://cdn.jsdelivr.net/gh/jenniferwonder/bimg/programming/z-PromiseState.png)\n\n#### æ‰§è¡Œç‰¹ç‚¹\n\n- Promise åªä»¥`ç¬¬ä¸€æ¬¡ä¸ºå‡†`ï¼Œç¬¬ä¸€æ¬¡æˆåŠŸå°±`æ°¸ä¹…`ä¸º`fulfilled`ï¼Œç¬¬ä¸€æ¬¡å¤±è´¥å°±æ°¸è¿œçŠ¶æ€ä¸º`rejected`\n- Promise ä¸­æœ‰ `throw` çš„è¯ï¼Œå°±ç›¸å½“äºæ‰§è¡Œäº†`reject`\n\n```js\nlet p1 = new Promise((resolve, reject) => {\n\tresolve(æˆåŠŸ);\n\treject(å¤±è´¥);\n});\nconsole.log(p1, p1);\n\nlet p2 = new Promise((resolve, reject) => {\n\treject(å¤±è´¥);\n\tresolve(æˆåŠŸ);\n});\nconsole.log(p2, p2);\n\nlet p3 = new Promise((resolve, reject) => {\n\tthrow æŠ¥é”™;\n});\nconsole.log(p3, p3);\n```\n\n#### Pending State ç‰¹ç‚¹\n\n- Promise é‡Œæ²¡æœ‰æ‰§è¡Œ`resolve`ã€`reject`ä»¥åŠ`throw`çš„è¯ï¼Œè¿™ä¸ª promise çš„çŠ¶æ€ä¹Ÿæ˜¯`pending`\n- `pending`çŠ¶æ€ä¸‹çš„ promise ä¸ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°`then()`\n\n```js\nlet myPromise1 = new Promise(() => {});\nconsole.log(myPromise1 :>> , myPromise1);\nlet myPromise2 = new Promise((resolve, reject) => {\n\tlet a = 1;\n\tfor (let index = 0; index < 5; index++) {\n\t\ta++;\n\t}\n});\nconsole.log(myPromise2 :>> , myPromise2);\nmyPromise2.then(() => {\n\tconsole.log(myPromise2æ‰§è¡Œäº†then); // åœ¨ Promise pending çŠ¶æ€ä¸‹ä¸ä¼šæ‰§è¡Œ\n});\n```\n\n## Create a Promise\n\n### `new Promise()`\n\n#### å‚æ•°è¦æ±‚\n\n- ä½¿ç”¨ `new Promise()` å¿…é¡»è¾“å…¥ä¸€ä¸ªæ‰§è¡Œå‡½æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™\n\n```js\nlet myPromise0 = new Promise();\nconsole.log(myPromise0 :>> , myPromise0); // æŠ¥é”™ï¼šTypeError: Promise resolver undefined\n```\n\n##### Case\n\n```js\nfunction makeRequest(location) {\n\treturn new Promise((resolve, reject) => {\n\t\tconsole.log(`Making Request to ${location}`);\n\t\tif (location === Google) {\n\t\t\tresolve(Google says Hi);\n\t\t} else {\n\t\t\treject(We can only talk to Google);\n\t\t}\n\t});\n}\n```\n\n#### â­ æ‰§è¡Œé¡ºåº\n\n- Promise æ„é€ å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œ`promise.then`Â  ä¸­çš„å‡½æ•°æ˜¯å¼‚æ­¥æ‰§è¡Œçš„\n\n##### Case\n\n```js\nconst promise = new Promise((resolve, reject) => {\n\tconsole.log(1);\n\tresolve();\n\tconsole.log(2);\n});\npromise.then(() => {\n\tconsole.log(3);\n});\nconsole.log(4);\n```\n\n##### Output\n\n```shell\n1\n2\n4\n3\n```\n\n### `Promise.resolve()`\n\nå°†ç°æœ‰å¯¹è±¡è½¬ä¸º Promise å¯¹è±¡\n\n```js\nPromise.resolve(foo);\n// ç­‰ä»·äº\nnew Promise((resolve) => resolve(foo));\n```\n\n#### å‚æ•°çš„å››ç§æƒ…å†µ\n\n1. å¦‚æœå‚æ•°æ˜¯ `Promise` å®ä¾‹\n   - é‚£ä¹ˆ `Promise.resolve()` å°†ä¸åšä»»ä½•ä¿®æ”¹ã€åŸå°ä¸åŠ¨åœ°è¿”å›è¿™ä¸ªå®ä¾‹ã€‚\n2. å‚æ•°æ˜¯ä¸€ä¸ª thenable (å…·æœ‰`then`æ–¹æ³•çš„å¯¹è±¡) å¯¹è±¡\n   - ä¼šå°†è¿™ä¸ªå¯¹è±¡è½¬ä¸º `Promise` å¯¹è±¡ï¼Œç„¶åå°±ç«‹å³æ‰§è¡Œ thenable å¯¹è±¡çš„ `then`æ–¹æ³•\n3. å‚æ•°æ˜¯ä¸€ä¸ªåŸå§‹å€¼ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªä¸å…·æœ‰`then`æ–¹æ³•çš„å¯¹è±¡\n   - åˆ™`Promise.resolve`æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ Â `Promise`Â  å¯¹è±¡ï¼ŒçŠ¶æ€ä¸º`resolved`\n4. `Promise.resolve()`æ–¹æ³•å…è®¸è°ƒç”¨æ—¶ä¸å¸¦å‚æ•°\n   - ç›´æ¥è¿”å›ä¸€ä¸ª `resolved`çŠ¶æ€çš„ `Promise` å¯¹è±¡ã€‚\n\n#### Example\n\n```js\nconst tick = Date.now();\nconst log = (v) => console.log(`${v} \\n Elapsed: ${Date.now() - tick}ms`);\nconst codeBlocker = () => {\n\t// Blocking\n\t// let i = 0;\n\t// while(i < 1000000000) { i++;}\n\t// return 'ğŸ· billion loops done';\n\n\t// Async blocking\n\t// return new Promise((resolve, reject) => {\n\t// let i = 0;\n\t// while(i < 1000000000) { i++;}\n\t// resolve('ğŸ· billion loops done');\n\t// })\n\n\t// Non-blocking\n\treturn Promise.resolve().then((v) => {\n\t\tlet i = 0;\n\t\twhile (i < 1000000000) {\n\t\t\ti++;\n\t\t}\n\t\treturn ğŸ· billion loops done;\n\t});\n};\nlog(ğŸ¥ª Synchronous 1);\ncodeBlocker().then(log);\nlog(ğŸ¥ª Synchronous 2);\n```\n\n### `Promise.reject()`\n\n- `Promise.reject()`æ–¹æ³•çš„å‚æ•°ï¼Œä¼šåŸå°ä¸åŠ¨åœ°ä½œä¸º`reject`çš„ç†ç”±ï¼Œå˜æˆåç»­æ–¹æ³•çš„å‚æ•°\n\n```js\nconst thenable = {\n\tthen(resolve, reject) {\n\t\treject(å‡ºé”™äº†);\n\t},\n};\nPromise.reject(thenable).catch((e) => {\n\tconsole.log(e === thenable);\n});\n// true\n```\n\n## Consume Promise\n\n### `Promise.prototype.then()`\n\næ¥æ”¶ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå‡ä¸ºå¯é€‰å‚æ•°\n\n```js\nPromise.resolve().then(onFulfilled()=>{}, onReject()={})\n```\n\n### `Promise.prototype.catch()`\n\n#### é”™è¯¯æ•è·æ¡ä»¶\n\nâŒ åœ¨`then`æˆ–`catch`ä¸­ `return` ä¸€ä¸ª `new Error` å¯¹è±¡ä¸ä¼šè¢«æ•è·ï¼š\n`return new Error(Error!)`\nâœ… å¿…é¡»ä½¿ç”¨ä»¥ä¸‹ä»»ä¸€ä¸€ç§è¯­æ³•ï¼š\n\n```js\nreturn Promise.reject(new Error(error!!!));\nthrow new Error(error!!!);\n```\n\n#### çº§è”é”™è¯¯\n\n- å¦‚æœåœ¨ Â `catch()`Â  å†…éƒ¨å¼•å‘é”™è¯¯ï¼Œåˆ™å¯ä»¥é™„åŠ ç¬¬äºŒä¸ª Â `catch()`æ¥å¤„ç†ï¼Œä¾æ­¤ç±»æ¨\n\n```js\nnew Promise((resolve, reject) => {\n\tthrow new Error(é”™è¯¯);\n})\n\t.catch((err) => {\n\t\tthrow new Error(é”™è¯¯);\n\t})\n\t.catch((err) => {\n\t\tconsole.error(err);\n\t});\n```\n\n### `Promise.prototype.finally()`\n\n- ç”¨äºæŒ‡å®šä¸ç®¡ Promise å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚è¯¥æ–¹æ³•æ˜¯ ES2018 å¼•å…¥æ ‡å‡†çš„\n  - é¿å…äº†åŒæ ·çš„è¯­å¥éœ€è¦åœ¨`then()`å’Œ`catch()`ä¸­å„å†™ä¸€æ¬¡çš„æƒ…å†µã€‚\n\n### Example (Consume Promise )\n\n#### Example (Promise chain)\n\n```js\n// import fetch from node-fetch;\nconst promise = fetch(https://jsonplaceholder.typicode.com/todos/1);\npromise\n\t.then((res) => res.json())\n\t.then((todo) => {\n\t\tthrow new Error(uh oh);\n\t\treturn todo;\n\t})\n\t.then((todo) => console.log(ğŸ˜›, todo.title)) // This line will be bypasses\n\t.catch((err) => console.error(ğŸ˜­, err));\nconsole.log(ğŸ¥ª Synchronous);\n```\n\n#### Example (Ice-cream Shop)\n\n- [[è‹±å­—] JavaScript å¼‚æ­¥ç¼–ç¨‹ï¼ˆAsync/Awaitã€Promiseã€Callbackï¼‰FreeCodeCamp](https://www.bilibili.com/video/BV1g44y1z7N3/?spm_id_from=333.788.recommend_more_video.4&vd_source=be278a4cfd00a5f72dcf153eaca79333)\n- [FreeCodeCamp-Blog](https://www.freecodecamp.org/news/javascript-async-await-tutorial-learn-callbacks-promises-async-await-by-making-icecream/)\n\n##### Relationship between time and work\n\n```javascript\nlet is_shop_open = true;\nlet order = (time, work) => {\n\treturn new Promise((resolve, reject) => {\n\t\tif (is_shop_open) {\n\t\t\tsetTimeout(() => {\n\t\t\t\t// work is ğŸ‘‡ getting done here\n\t\t\t\tresolve(work());\n\t\t\t\t// Setting ğŸ‘‡ time here for 1 work\n\t\t\t}, time);\n\t\t} else {\n\t\t\treject(console.log(Our shop is closed));\n\t\t}\n\t});\n};\n```\n\n##### Promise chaining\n\n```js\n// step 1\norder(2000, () => console.log(`${stocks.Fruits[0]} was selected`))\n\t// step 2\n\t.then(() => order(0000, () => console.log(production has started)))\n\t// step 3\n\t.then(() => {\n\t\treturn order(2000, () => console.log(Fruit has been chopped));\n\t})\n\t// step 4\n\t.then(() => {\n\t\treturn order(1000, () =>\n\t\t\tconsole.log(`${stocks.liquid[0]} and ${stocks.liquid[1]} added`)\n\t\t);\n\t})\n\t// step 5\n\t.then(() => {\n\t\treturn order(1000, () => console.log(start the machine));\n\t})\n\t// step 6\n\t.then(() => {\n\t\treturn order(2000, () =>\n\t\t\tconsole.log(`ice cream placed on ${stocks.holder[1]}`)\n\t\t);\n\t})\n\t// step 7\n\t.then(() => {\n\t\treturn order(3000, () => console.log(`${stocks.toppings[0]} as toppings`));\n\t})\n\t// Step 8\n\t.then(() => {\n\t\treturn order(2000, () => console.log(Serve Ice Cream));\n\t});\n```\n\n##### Error handling\n\n```javascript\nlet is_shop_open = false;\n// Add Error handling at the end of the Promise chain\n.catch(()=>{\n  console.log(Customer left)\n})\n// Output:\n// Our shop is closed -- from reject\n// Customer left -- from catch\n```\n\n##### TheÂ `.finally`Â handler\n\nTheÂ `finally`Â handler which works regardless of whether our promise was resolved or rejected.\n\n```javascript\n// Whether we serve no customers or 100 customers, our shop will close at the end of the day. Optional - Add `finally` at the very bottom of the chain\n.finally(()=>{\n  console.log(end of day)\n})\n```\n\n#### Avoid Mistakes\n\n```js\ndoSomething()\n\t.then(function (result) {\n\t\t// If using a full function expression: return the promise\n\t\treturn doSomethingElse(result);\n\t})\n\t// If using arrow functions: omit the braces and implicitly return the result\n\t.then((newResult) => doThirdThing(newResult))\n\t// Even if the previous chained promise returns a result, the next one\n\t// doesn't necessarily have to use it. You can pass a handler that doesn't\n\t// consume any result.\n\t.then((/* result ignored */) => doFourthThing())\n\t// Always end the promise chain with a catch handler to avoid any\n\t// unhandled rejections!\n\t.catch((error) => console.error(error));\n```\n\n## More Promise Method (æ›´å¤š Promise å¯¹è±¡æ–¹æ³•)\n\n### `Promise.all()`\n\n- å‘èµ·å¤šä¸ªå¹¶å‘è¯·æ±‚ï¼Œç„¶ååœ¨æ‰€æœ‰ promise éƒ½è¢«è§£å†³åæ‰§è¡Œä¸€äº›æ“ä½œ\n- é€‚åˆå½¼æ­¤ç›¸äº’ä¾èµ–æˆ–è€…åœ¨å…¶ä¸­ä»»ä½•ä¸€ä¸ª`reject`æ—¶ç«‹å³ç»“æŸ\n\n```js\nconst promise1 = Promise.resolve(3);\nconst promise2 = 42;\nconst promise3 = new Promise((resolve, reject) => {\n\tsetTimeout(resolve, 100, foo);\n});\nPromise.all([promise1, promise2, promise3]).then((values) => {\n\tconsole.log(values);\n});\n// expected output: Array [3, 42, foo]\n```\n\n### `Promise.race()`\n\n- ä¼ å…¥å¤šä¸ª promise å®ä¾‹ï¼Œè°è·‘çš„å¿«ï¼Œå°±ä»¥è°çš„ç»“æœæ‰§è¡Œå›è°ƒ\n\n```js\nconst first = new Promise((resolve, reject) => {\n\tsetTimeout(resolve, 500, ç¬¬ä¸€ä¸ª);\n});\nconst second = new Promise((resolve, reject) => {\n\tsetTimeout(resolve, 100, ç¬¬äºŒä¸ª);\n});\nPromise.race([first, second]).then((result) => {\n\tconsole.log(result); // ç¬¬äºŒä¸ª\n});\n```\n\n#### Use Case\n\n1ã€æŠŠå¼‚æ­¥æ“ä½œå’Œå®šæ—¶å™¨æ”¾åˆ°ä¸€èµ·ï¼Œå¦‚æœå®šæ—¶å™¨å…ˆè§¦å‘ï¼Œè®¤ä¸ºè¶…æ—¶ï¼Œå‘ŠçŸ¥ç”¨æˆ·\n\n```js\nfunction timeOut(time) {\n\tlet result = new Promise((resolve, reject) => {\n\t\tsetTimeout(() => {\n\t\t\tresolve(è¯·æ±‚è¶…æ—¶);\n\t\t}, time); // ä¸ºäº†éªŒè¯æ–¹æ³•ï¼Œå¯ä»¥æŠŠæ—¶é—´è®¾å°ç‚¹\n\t});\n\treturn result;\n}\nPromise.race([timeOut(200), fetch(https://api.github.com/users/ruanyf)]).then(\n\t(res) => {\n\t\tconsole.log(res);\n\t}\n);\n```\n\n2ã€å¦‚æœå›¾ç‰‡ç­‰èµ„æºæœ‰å¤šä¸ªå­˜æ”¾è·¯å¾„ï¼Œä½†æ˜¯ä¸ç¡®å®šå“ªä¸ªè·¯å¾„çš„èµ„æºæ›´å¿«ï¼Œå¯ä»¥ç”¨è¯¥æ–¹æ³•åŒæ—¶è¯·æ±‚å¤šä¸ªè·¯å¾„ï¼Œå“ªä¸ªè·¯å¾„çš„èµ„æºæœ€å…ˆæ‹¿åˆ°ï¼Œä½¿ç”¨å“ªä¸ªèµ„æº\n\n3ã€å¦‚æœæŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è·å¾—ç»“æœï¼Œå°±å°† Promise çš„çŠ¶æ€å˜ä¸º `reject`ï¼Œå¦åˆ™å˜ä¸º`resolve`\n\n```js\nconst p = Promise.race([\n\tfetch(/resource-that-may-take-a-while),\n\tnew Promise(function (resolve, reject) {\n\t\tsetTimeout(() => reject(new Error(request timeout)), 5000);\n\t}),\n]);\np.then(console.log).catch(console.error);\n```\n\n### `Promise.allSettled()` (ES2020)\n\n- ç”± ES2020 å¼•å…¥\n- åŠŸèƒ½\n  - æœ‰å¤šä¸ªå½¼æ­¤ä¸ä¾èµ–çš„å¼‚æ­¥ä»»åŠ¡æˆåŠŸå®Œæˆæ—¶ï¼Œæˆ–è€…æ‚¨æ€»æ˜¯æƒ³çŸ¥é“æ¯ä¸ª promise çš„ç»“æœæ—¶ï¼Œé€šå¸¸ä½¿ç”¨\n  - `Promise.all()`æ— æ³•ç¡®å®šæ‰€æœ‰è¯·æ±‚éƒ½ç»“æŸã€‚æƒ³è¦è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œå†™èµ·æ¥å¾ˆéº»çƒ¦ï¼Œæœ‰äº†`Promise.allSettled()`ï¼Œè¿™å°±å¾ˆå®¹æ˜“äº†\n\n```js\nconst urls = [\n\t/* ... */\n];\nconst requests = urls.map((x) => fetch(x));\ntry {\n\tawait Promise.all(requests);\n\tconsole.log(æ‰€æœ‰è¯·æ±‚éƒ½æˆåŠŸã€‚);\n} catch {\n\tconsole.log(è‡³å°‘ä¸€ä¸ªè¯·æ±‚å¤±è´¥ï¼Œå…¶ä»–è¯·æ±‚å¯èƒ½è¿˜æ²¡ç»“æŸã€‚);\n}\n```\n\n#### è¿”å›å€¼\n\n- è¿”å›ä¸€ä¸ªåœ¨æ‰€æœ‰ç»™å®šçš„ promise éƒ½å·²ç»`fulfilled`æˆ–`rejected`åçš„ promiseï¼Œå¹¶å¸¦æœ‰ä¸€ä¸ª**å¯¹è±¡æ•°ç»„**ï¼Œæ¯ä¸ªå¯¹è±¡è¡¨ç¤ºå¯¹åº”çš„ promise ç»“æœ\n  - ![](https://cdn.jsdelivr.net/gh/jenniferwonder/bimg/programming/z-Promise.allSettled.png)\n- æ¯ä¸ªå¯¹è±¡éƒ½æœ‰`status`å±æ€§ï¼Œè¯¥å±æ€§çš„å€¼åªå¯èƒ½æ˜¯å­—ç¬¦ä¸²`fulfilled`æˆ–å­—ç¬¦ä¸²`rejected`ã€‚\n  - `fulfilled`æ—¶ï¼Œå¯¹è±¡æœ‰`value`å±æ€§ï¼Œ\n  - `rejected`æ—¶æœ‰`reason`å±æ€§ï¼Œå¯¹åº”ä¸¤ç§çŠ¶æ€çš„è¿”å›å€¼ã€‚\n\n```js\nconst promises = [fetch(index.html), fetch(https://does-not-exist/)];\nconst results = await Promise.allSettled(promises);\n// è¿‡æ»¤å‡ºæˆåŠŸçš„è¯·æ±‚\nconst successfulPromises = results.filter((p) => p.status === fulfilled);\n// è¿‡æ»¤å‡ºå¤±è´¥çš„è¯·æ±‚ï¼Œå¹¶è¾“å‡ºåŸå› \nconst errors = results\n\t.filter((p) => p.status === rejected)\n\t.map((p) => p.reason);\n```\n\n### `Promise.any()` (ES2020)\n\n- è¾“å…¥\n  - ä¸€ä¸ª Promise æ•°ç»„\n- è¿”å›å€¼\n  - ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡\n    - è¯¥ Promise å¯¹è±¡åœ¨ä¼ å…¥çš„ Promise æ•°ç»„ä¸­çš„ä»»ä½•ä¸€ä¸ª Promise è§£å†³æ—¶å°±ä¼šè¢«è§£å†³\n    - è‹¥æ‰€æœ‰çš„ Promise éƒ½è¢«æ‹’ç»ï¼Œåˆ™è¿”å›çš„ Promise ä¼šè¢«æ‹’ç»ï¼Œå¹¶ä¸”å®ƒçš„æ‹’å› æ˜¯ä¸€ä¸ª `AggregateError` å¯¹è±¡å®ä¾‹ï¼ŒåŒ…å«äº†æ‰€æœ‰è¢«æ‹’ç»çš„ Promise çš„åŸå›  (å¯é€šè¿‡ `.errors` å±æ€§è¯»å–)\n- è¿”å›å€¼å¤„ç†\n\n```js\nPromise.any([p10, p11])\n\t.then((res) => console.log(res))\n\t.catch((err) => {\n\t\tif (err instanceof AggregateError) {\n\t\t\tconsole.error(AggregateError occurred:);\n\t\t\tconsole.log(err.errors);\n\t\t\terr.errors.forEach((err, index) => {\n\t\t\t\tconsole.error(`Error ${index + 1}:`, err);\n\t\t\t});\n\t\t} else {\n\t\t\tconsole.error(Other error occurred:, err);\n\t\t}\n\t});\n```\n"}function compiledContent(){return html}function getHeadings(){return[{depth:1,slug:"promise",text:"Promise#"},{depth:2,slug:"reference",text:"Reference#"},{depth:3,slug:"write-a-promise",text:"Write a Promise#"},{depth:2,slug:"what-is-a-promise",text:"What is a Promise?#"},{depth:2,slug:"promise-state--result",text:"Promise State & Result#"},{depth:4,slug:"3-ç§çŠ¶æ€-promisestate",text:"3 ç§çŠ¶æ€ (PromiseState)#"},{depth:4,slug:"æ‰§è¡Œç‰¹ç‚¹",text:"æ‰§è¡Œç‰¹ç‚¹#"},{depth:4,slug:"pending-state-ç‰¹ç‚¹",text:"Pending State ç‰¹ç‚¹#"},{depth:2,slug:"create-a-promise",text:"Create a Promise#"},{depth:3,slug:"new-promise",text:"new Promise()#"},{depth:4,slug:"å‚æ•°è¦æ±‚",text:"å‚æ•°è¦æ±‚#"},{depth:5,slug:"case",text:"Case#"},{depth:4,slug:"-æ‰§è¡Œé¡ºåº",text:"â­ æ‰§è¡Œé¡ºåº#"},{depth:5,slug:"case-1",text:"Case#"},{depth:5,slug:"output",text:"Output#"},{depth:3,slug:"promiseresolve",text:"Promise.resolve()#"},{depth:4,slug:"å‚æ•°çš„å››ç§æƒ…å†µ",text:"å‚æ•°çš„å››ç§æƒ…å†µ#"},{depth:4,slug:"example",text:"Example#"},{depth:3,slug:"promisereject",text:"Promise.reject()#"},{depth:2,slug:"consume-promise",text:"Consume Promise#"},{depth:3,slug:"promiseprototypethen",text:"Promise.prototype.then()#"},{depth:3,slug:"promiseprototypecatch",text:"Promise.prototype.catch()#"},{depth:4,slug:"é”™è¯¯æ•è·æ¡ä»¶",text:"é”™è¯¯æ•è·æ¡ä»¶#"},{depth:4,slug:"çº§è”é”™è¯¯",text:"çº§è”é”™è¯¯#"},{depth:3,slug:"promiseprototypefinally",text:"Promise.prototype.finally()#"},{depth:3,slug:"example-consume-promise-",text:"Example (Consume Promise )#"},{depth:4,slug:"example-promise-chain",text:"Example (Promise chain)#"},{depth:4,slug:"example-ice-cream-shop",text:"Example (Ice-cream Shop)#"},{depth:5,slug:"relationship-between-time-and-work",text:"Relationship between time and work#"},{depth:5,slug:"promise-chaining",text:"Promise chaining#"},{depth:5,slug:"error-handling",text:"Error handling#"},{depth:5,slug:"thefinallyhandler",text:"TheÂ .finallyÂ handler#"},{depth:4,slug:"avoid-mistakes",text:"Avoid Mistakes#"},{depth:2,slug:"more-promise-method-æ›´å¤š-promise-å¯¹è±¡æ–¹æ³•",text:"More Promise Method (æ›´å¤š Promise å¯¹è±¡æ–¹æ³•)#"},{depth:3,slug:"promiseall",text:"Promise.all()#"},{depth:3,slug:"promiserace",text:"Promise.race()#"},{depth:4,slug:"use-case",text:"Use Case#"},{depth:3,slug:"promiseallsettled-es2020",text:"Promise.allSettled() (ES2020)#"},{depth:4,slug:"è¿”å›å€¼",text:"è¿”å›å€¼#"},{depth:3,slug:"promiseany-es2020",text:"Promise.any() (ES2020)#"}]}const Content=createComponent(((s,n,e)=>{const{layout:o,...a}=frontmatter;return a.file=file,a.url=url,renderTemplate`${maybeRenderHead()}${unescapeHTML(html)}`})),promise=Object.freeze(Object.defineProperty({__proto__:null,Content:Content,compiledContent:compiledContent,default:Content,file:file,frontmatter:frontmatter,getHeadings:getHeadings,rawContent:rawContent,url:url},Symbol.toStringTag,{value:"Module"}));export{_internal,body,collection,data,id,promise,slug};